tbn@obtv-svr2:~/pollmetry$ docker compose logs -f
WARN[0000] /home/tbn/pollmetry/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion 
pollmetry-app  | /app/dist/index.cjs:64
pollmetry-db   | The files belonging to this database system will be owned by user "postgres".
pollmetry-db   | This user must also own the server process.
pollmetry-db   | 
pollmetry-db   | The database cluster will be initialized with locale "en_US.utf8".
pollmetry-db   | The default database encoding has accordingly been set to "UTF8".
pollmetry-db   | The default text search configuration will be set to "english".
pollmetry-db   | 
pollmetry-db   | Data page checksums are disabled.
pollmetry-db   | 
pollmetry-db   | fixing permissions on existing directory /var/lib/postgresql/data ... ok
pollmetry-db   | creating subdirectories ... ok
pollmetry-db   | selecting dynamic shared memory implementation ... posix
pollmetry-db   | selecting default max_connections ... 100
pollmetry-db   | selecting default shared_buffers ... 128MB
pollmetry-db   | selecting default time zone ... UTC
pollmetry-db   | creating configuration files ... ok
pollmetry-db   | running bootstrap script ... ok
pollmetry-db   | sh: locale: not found
pollmetry-db   | 2026-01-16 19:09:08.088 UTC [35] WARNING:  no usable system locales were found
pollmetry-db   | performing post-bootstrap initialization ... ok
pollmetry-db   | syncing data to disk ... ok
pollmetry-db   | initdb: warning: enabling "trust" authentication for local connections
pollmetry-db   | initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.
pollmetry-db   | 
pollmetry-db   | 
pollmetry-db   | Success. You can now start the database server using:
pollmetry-db   | 
pollmetry-db   |     pg_ctl -D /var/lib/postgresql/data -l logfile start
pollmetry-db   | 
pollmetry-db   | waiting for server to start....2026-01-16 19:09:08.863 UTC [41] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
pollmetry-db   | 2026-01-16 19:09:08.874 UTC [41] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
pollmetry-db   | 2026-01-16 19:09:08.907 UTC [44] LOG:  database system was shut down at 2026-01-16 19:09:08 UTC
pollmetry-db   | 2026-01-16 19:09:08.927 UTC [41] LOG:  database system is ready to accept connections
pollmetry-db   |  done
pollmetry-db   | server started
pollmetry-db   | CREATE DATABASE
pollmetry-db   | 
pollmetry-db   | 
pollmetry-db   | /usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/init-db.sql
pollmetry-db   | CREATE EXTENSION
pollmetry-db   | GRANT
pollmetry-db   | 
pollmetry-db   | 
pollmetry-db   | waiting for server to shut down....2026-01-16 19:09:09.232 UTC [41] LOG:  received fast shutdown request
pollmetry-db   | 2026-01-16 19:09:09.243 UTC [41] LOG:  aborting any active transactions
pollmetry-db   | 2026-01-16 19:09:09.251 UTC [41] LOG:  background worker "logical replication launcher" (PID 47) exited with exit code 1
pollmetry-db   | 2026-01-16 19:09:09.251 UTC [42] LOG:  shutting down
pollmetry-db   | 2026-01-16 19:09:09.261 UTC [42] LOG:  checkpoint starting: shutdown immediate
pollmetry-db   | 2026-01-16 19:09:09.439 UTC [42] LOG:  checkpoint complete: wrote 926 buffers (5.7%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.062 s, sync=0.064 s, total=0.188 s; sync files=301, longest=0.020 s, average=0.001 s; distance=4282 kB, estimate=4282 kB; lsn=0/1921138, redo lsn=0/1921138
pollmetry-db   | 2026-01-16 19:09:09.457 UTC [41] LOG:  database system is shut down
pollmetry-db   |  done
pollmetry-db   | server stopped
pollmetry-db   | 
pollmetry-db   | PostgreSQL init process complete; ready for start up.
pollmetry-db   | 
pollmetry-db   | 2026-01-16 19:09:09.599 UTC [1] LOG:  starting PostgreSQL 16.11 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
pollmetry-db   | 2026-01-16 19:09:09.600 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
pollmetry-db   | 2026-01-16 19:09:09.600 UTC [1] LOG:  listening on IPv6 address "::", port 5432
pollmetry-db   | 2026-01-16 19:09:09.628 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
pollmetry-db   | 2026-01-16 19:09:09.661 UTC [59] LOG:  database system was shut down at 2026-01-16 19:09:09 UTC
pollmetry-db   | 2026-01-16 19:09:09.683 UTC [1] LOG:  database system is ready to accept connections
pollmetry-db   | 2026-01-16 19:09:13.767 UTC [70] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:13.767 UTC [70] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-db   | 2026-01-16 19:09:14.955 UTC [71] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:14.955 UTC [71] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-db   | 2026-01-16 19:09:16.123 UTC [72] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:16.123 UTC [72] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-db   | 2026-01-16 19:09:17.258 UTC [73] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:17.258 UTC [73] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-db   | 2026-01-16 19:09:18.819 UTC [74] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:18.819 UTC [74] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-app  | `);Ra.write(kw.format.apply(kw,e))}}Object.defineProperty(Ht.exports,"isWin",{get:function(){return Bo},set:function(t){Bo=t}});Ht.exports.warnTo=function(t){var e=Ra;return Ra=t,e};Ht.exports.getFileName=function(t){var e=t||process.env,n=e.PGPASSFILE||(Bo?Ew.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ew.join(e.HOME||"./",".pgpass"));return n};Ht.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Bo?!0:(e=e||"<unkn>",a9(t.mode)?t.mode&(t9|n9)?(Hd('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hd('WARNING: password file "%s" is not a plain file',e),!1))};var o9=Ht.exports.match=function(t,e){return ei.slice(0,-1).reduce(function(n,r,i){return i==1&&Number(t[r]||e9)===Number(e[r])?n&&!0:n&&(e[r]==="*"||e[r]===t[r])},!0)};Ht.exports.getPassword=function(t,e,n){var r,i=e.pipe(Yq());function a(c){var u=c9(c);u&&u9(u)&&o9(t,u)&&(r=u[s9],i.end())}var s=function(){e.destroy(),n(r)},o=function(c){e.destroy(),Hd("WARNING: error on reading file: %s",c),n(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var c9=Ht.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",n="",r=0,i=0,a=0,s={},o=!1,c=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[ei[l]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),n=t.charAt(u),o=r==Vd-1,o){c(r,i);break}u>=0&&e==":"&&n!=="\\"&&(c(r,i,u+1),i=u+2,r+=1)}return s=Object.keys(s).length===Vd?s:null,s},u9=Ht.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},n=0;n<ei.length;n+=1){var r=e[n],i=t[ei[n]]||"",a=r(i);if(!a)return!1}return!0}});var Aw=g((CF,Gd)=>{"use strict";var TF=require("path"),Cw=require("fs"),Fo=Tw();Gd.exports=function(t,e){var n=Fo.getFileName();Cw.stat(n,function(r,i){if(r||!Fo.usePgPass(i,n))return e(void 0);var a=Cw.createReadStream(n);Fo.getPassword(t,a,e)})};Gd.exports.warnTo=Fo.warnTo});var jw=g((AF,Iw)=>{"use strict";var l9=require("events").EventEmitter,Pw=Wr(),Kd=W1(),p9=Io(),d9=vd(),qw=cw(),f9=Na(),m9=Qd(),h9=fd(),Lo=class extends l9{constructor(e){super(),this.connectionParameters=new d9(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let n=e||{};this._Promise=n.Promise||global.Promise,this._types=new p9(n.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!n.enableChannelBinding,this.connection=n.connection||new m9({stream:n.stream,ssl:this.connectionParameters.ssl,keepAlive:n.keepAlive||!1,keepAliveInitialDelayMillis:n.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=n.binary||f9.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=n.connectionTimeoutMillis||0}_errorAllQueries(e){let n=r=>{process.nextTick(()=>{r.handleError(e,this.connection)})};this.activeQuery&&(n(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(n),this.queryQueue.length=0}_connect(e){let n=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{r._ending=!0,r.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){n.ssl?r.requestSsl():r.startup(n.getStartupConf())}),r.on("sslconnect",function(){r.startup(n.getStartupConf())}),this._attachListeners(r),r.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((n,r)=>{this._connect(i=>{i?r(i):n()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let n=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(r=>{if(r!==void 0){if(typeof r!="string"){n.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()}).catch(r=>{n.emit("error",r)});else if(this.password!==null)e();else try{Aw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(r){this.emit("error",r)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let n=await h9.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(n)}catch(n){this.emit("error",n)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Kd.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(n){this.connection.emit("error",n)}})}async _handleAuthSASLContinue(e){try{await Kd.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(n){this.connection.emit("error",n)}}_handleAuthSASLFinal(e){try{Kd.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(n){this.connection.emit("error",n)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:n}=this;this.activeQuery=null,this.readyForQuery=!0,n&&n.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let n=this.activeQuery;if(!n){this._handleErrorEvent(e);return}this.activeQuery=null,n.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let n=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(n);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,n={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(n.application_name=r),e.replication&&(n.replication=""+e.replication),e.statement_timeout&&(n.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(n.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(n.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(n.options=e.options),n}cancel(e,n){if(e.activeQuery===n){let r=this.connection;this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){r.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(n)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(n),1)}setTypeParser(e,n,r){return this._types.setTypeParser(e,n,r)}getTypeParser(e,n){return this._types.getTypeParser(e,n)}escapeIdentifier(e){return Pw.escapeIdentifier(e)}escapeLiteral(e){return Pw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,n,r){let i,a,s,o,c;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof n=="function"&&(i.callback=i.callback||n)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new qw(e,n,r),i.callback||(a=new this._Promise((u,l)=>{i.callback=(p,d)=>p?l(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),s&&(c=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),c(u),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(n=>{this.connection.once("end",n)})}};Lo.Query=qw;Iw.exports=Lo});var Dw=g((PF,Rw)=>{"use strict";var v9=require("events").EventEmitter,Nw=function(){},Ow=(t,e)=>{let n=t.findIndex(e);return n===-1?void 0:t.splice(n,1)[0]},Wd=class{constructor(e,n,r){this.client=e,this.idleListener=n,this.timeoutId=r}},ti=class{constructor(e){this.callback=e}};function g9(){throw new Error("Release called on client which has already been released to the pool.")}function zo(t,e){if(e)return{callback:e,result:void 0};let n,r,i=function(s,o){s?n(s):r(o)},a=new t(function(s,o){r=s,n=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function y9(t,e){return function n(r){r.client=e,e.removeListener("error",n),e.on("error",()=>{t.log("additional client error after disconnection due to error",r)}),t._remove(e),t.emit("error",r,e)}}var Zd=class extends v9{constructor(e,n){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||n||Jd().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(n=>{this._remove(n.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let n=this._idle.pop();clearTimeout(n.timeoutId);let r=n.client;r.ref&&r.ref();let i=n.idleListener;return this._acquireClient(r,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,n){let r=Ow(this._idle,a=>a.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof n=="function"&&n()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let n=zo(this.Promise,e),r=n.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ti(n.callback)),r;let i=(o,c,u)=>{clearTimeout(s),n.callback(o,c,u)},a=new ti(i),s=setTimeout(()=>{Ow(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,n.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),r}return this.newClient(new ti(n.callback)),r}newClient(e){let n=new this.Client(this.options);this._clients.push(n);let r=y9(this,n);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,n.connection?n.connection.stream.destroy():n.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),n.connect(s=>{if(i&&clearTimeout(i),n.on("error",r),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==n),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,Nw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(n),this._idle.findIndex(u=>u.client===n)!==-1&&this._acquireClient(n,new ti((u,l,p)=>p()),r,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),n.once("end",()=>clearTimeout(o))}return this._acquireClient(n,e,r,!0)}})}_acquireClient(e,n,r,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,r),e.removeListener("error",r),n.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),n.callback(a,void 0,Nw);n.callback(void 0,e,e.release)}):n.callback(void 0,e,e.release)}_releaseOnce(e,n){let r=!1;return i=>{r&&g9(),r=!0,this._release(e,n,i)}}_release(e,n,r){if(e.on("error",n),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",r,e),r||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Wd(e,n,a)),this._pulseQueue()}query(e,n,r){if(typeof e=="function"){let a=zo(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof n=="function"&&(r=n,n=void 0);let i=zo(this.Promise,r);return r=i.callback,this.connect((a,s)=>{if(a)return r(a);let o=!1,c=u=>{o||(o=!0,s.release(u),r(u))};s.once("error",c),this.log("dispatching query");try{s.query(e,n,(u,l)=>{if(this.log("query dispatched"),s.removeListener("error",c),!o)return o=!0,s.release(u),u?r(u):r(void 0,l)})}catch(u){return s.release(u),r(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let r=new Error("Called end on pool more than once");return e?e(r):this.Promise.reject(r)}this.ending=!0;let n=zo(this.Promise,e);return this._endCallback=n.callback,this._pulseQueue(),n.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,n)=>e+(this._expired.has(n)?1:0),0)}get totalCount(){return this._clients.length}};Rw.exports=Zd});var Fw=g((qF,Bw)=>{"use strict";var Mw=require("events").EventEmitter,x9=require("util"),Xd=Wr(),ni=Bw.exports=function(t,e,n){Mw.call(this),t=Xd.normalizeQueryConfig(t,e,n),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(r){r==="row"&&(this._emitRowEvents=!0)}.bind(this))};x9.inherits(ni,Mw);var b9={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};ni.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let n in e){let r=b9[n]||n;t[r]=e[n]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};ni.prototype.then=function(t,e){return this._getPromise().then(t,e)};ni.prototype.catch=function(t){return this._getPromise().catch(t)};ni.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};ni.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let n=function(r,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),r)return e.handleError(r);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(c=>{e.emit("row",c,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(n=process.domain.bind(n)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let r=(this.values||[]).map(Xd.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return n(i)}return t.native.execute(this.name,r,n)}return t.native.prepare(this.name,this.text,r.length,function(i){return i?n(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,r,n))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return n(i)}let r=this.values.map(Xd.prepareValue);t.native.query(this.text,r,n)}else this.queryMode==="extended"?t.native.query(this.text,[],n):t.native.query(this.text,n)}});var Qw=g((IF,Uw)=>{"use strict";var Lw;try{Lw=require("pg-native")}catch(t){throw t}var w9=Io(),zw=require("events").EventEmitter,S9=require("util"),_9=vd(),$w=Fw(),rt=Uw.exports=function(t){zw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new w9(t.types),this.native=new Lw({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new _9(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};rt.Query=$w;S9.inherits(rt,zw);rt.prototype._errorAllQueries=function(t){let e=n=>{process.nextTick(()=>{n.native=this.native,n.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};rt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(n,r){if(e.connectionParameters.nativeConnectionString&&(r=e.connectionParameters.nativeConnectionString),n)return t(n);e.native.connect(r,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};rt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,n)=>{this._connect(r=>{r?n(r):e()})})};rt.prototype.query=function(t,e,n){let r,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=r=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,r=new $w(t,e,n),!r.callback){let c,u;i=new this._Promise((l,p)=>{c=l,u=p}).catch(l=>{throw Error.captureStackTrace(l),l}),r.callback=(l,p)=>l?u(l):c(p)}return a&&(o=r.callback,s=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{r.handleError(c,this.connection)}),o(c),r.callback=()=>{};let u=this._queryQueue.indexOf(r);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),r.callback=(c,u)=>{clearTimeout(s),o(c,u)}),this._queryable?this._ending?(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(r),this._pulseQueryQueue(),i):(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};rt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let n;return t||(n=new this._Promise(function(r,i){t=a=>a?i(a):r()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),n};rt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};rt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let n=this;e.once("_done",function(){n._pulseQueryQueue()})};rt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};rt.prototype.ref=function(){};rt.prototype.unref=function(){};rt.prototype.setTypeParser=function(t,e,n){return this._types.setTypeParser(t,e,n)};rt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Yd=g((jF,Vw)=>{"use strict";Vw.exports=Qw()});var Jd=g((OF,Da)=>{"use strict";var E9=jw(),k9=Na(),T9=Qd(),C9=yd(),A9=Wr(),P9=Dw(),q9=Io(),{DatabaseError:I9}=zd(),{escapeIdentifier:j9,escapeLiteral:N9}=Wr(),O9=t=>class extends P9{constructor(n){super(n,t)}},ef=function(t){this.defaults=k9,this.Client=t,this.Query=this.Client.Query,this.Pool=O9(this.Client),this._pools=[],this.Connection=T9,this.types=ja(),this.DatabaseError=I9,this.TypeOverrides=q9,this.escapeIdentifier=j9,this.escapeLiteral=N9,this.Result=C9,this.utils=A9};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Da.exports=new ef(Yd()):(Da.exports=new ef(E9),Object.defineProperty(Da.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new ef(Yd())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Da.exports,"native",{value:t}),t}}))});var B9={};df(B9,{log:()=>lf});module.exports=oS(B9);var Vo=ai(nl(),1);var Ww=require("socket.io");var Jp={};df(Jp,{EMOJIS:()=>T3,insertQuestionSchema:()=>E3,insertSessionSchema:()=>Zp,insertUserSchema:()=>Wp,insertVoteEventSchema:()=>k3,questionStateEnum:()=>x3,questionTypeEnum:()=>b3,questions:()=>te,questionsRelations:()=>w3,segmentEnum:()=>S3,sessions:()=>oe,sessionsRelations:()=>y3,users:()=>He,usersRelations:()=>g3,voteEvents:()=>de,voteEventsRelations:()=>_3});var m=Symbol.for("drizzle:entityKind"),tN=Symbol.for("drizzle:hasOwnEntityKind");function x(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=Object.getPrototypeOf(t).constructor;if(n)for(;n;){if(m in n&&n[m]===e[m])return!0;n=Object.getPrototypeOf(n)}return!1}var G=class{constructor(e,n){this.table=e,this.config=n,this.name=n.name,this.keyAsName=n.keyAsName,this.notNull=n.notNull,this.default=n.default,this.defaultFn=n.defaultFn,this.onUpdateFn=n.onUpdateFn,this.hasDefault=n.hasDefault,this.primary=n.primaryKey,this.isUnique=n.isUnique,this.uniqueName=n.uniqueName,this.uniqueType=n.uniqueType,this.dataType=n.dataType,this.columnType=n.columnType,this.generated=n.generated,this.generatedIdentity=n.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Ks=class{static[m]="ColumnBuilder";config;constructor(e,n,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:n,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var St=Symbol.for("drizzle:Name");var Ws=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,n){this.reference=()=>{let{name:r,columns:i,foreignColumns:a}=e();return{name:r,columns:i,foreignTable:a[0].table,foreignColumns:a}},n&&(this._onUpdate=n.onUpdate,this._onDelete=n.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new rl(e,this)}},rl=class{constructor(e,n){this.table=e,this.reference=n.reference,this.onUpdate=n._onUpdate,this.onDelete=n._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:n,foreignColumns:r}=this.reference(),i=n.map(o=>o.name),a=r.map(o=>o.name),s=[this.table[St],...i,r[0].table[St],...a];return e??`${s.join("_")}_fk`}};function Zs(t,...e){return t(...e)}function sl(t,e){return`${t[St]}_${e.join("_")}_unique`}var il=class{constructor(e,n){this.name=n,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new al(e,this.columns,this.nullsNotDistinctConfig,this.name)}},wb=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new il(e,this.name)}},al=class{constructor(e,n,r,i){this.table=e,this.columns=n,this.name=i??sl(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=r}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Sb(t,e,n){for(let r=e;r<t.length;r++){let i=t[r];if(i==="\\"){r++;continue}if(i==='"')return[t.slice(e,r).replace(/\\/g,""),r+1];if(!n&&(i===","||i==="}"))return[t.slice(e,r).replace(/\\/g,""),r]}return[t.slice(e).replace(/\\/g,""),t.length]}function _b(t,e=0){let n=[],r=e,i=!1;for(;r<t.length;){let a=t[r];if(a===","){(i||r===e)&&n.push(""),i=!0,r++;continue}if(i=!1,a==="\\"){r+=2;continue}if(a==='"'){let[c,u]=Sb(t,r+1,!0);n.push(c),r=u;continue}if(a==="}")return[n,r+1];if(a==="{"){let[c,u]=_b(t,r+1);n.push(c),r=u;continue}let[s,o]=Sb(t,r,!1);n.push(s),r=o}return[n,r]}function Eb(t){let[e]=_b(t,1);return e}function ol(t){return`{${t.map(e=>Array.isArray(e)?ol(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var P=class extends Ks{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new ul(this.config.name,this,e)}references(e,n={}){return this.foreignKeyConfigs.push({ref:e,actions:n}),this}unique(e,n){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,n){return this.foreignKeyConfigs.map(({ref:r,actions:i})=>Zs((a,s)=>{let o=new Ws(()=>{let c=a();return{columns:[e],foreignColumns:[c]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(n)},r,i))}buildExtraConfigColumn(e){return new cl(e,this.config)}},S=class extends G{constructor(e,n){n.uniqueName||(n.uniqueName=sl(e,[n.name])),super(e,n),this.table=e}static[m]="PgColumn"},cl=class extends S{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},qr=class{static[m]="IndexedColumn";constructor(e,n,r,i){this.name=e,this.keyAsName=n,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},ul=class extends P{static[m]="PgArrayBuilder";constructor(e,n,r){super(e,"array","PgArray"),this.config.baseBuilder=n,this.config.size=r}build(e){let n=this.config.baseBuilder.build(e);return new ll(e,this.config,n)}},ll=class t extends S{constructor(e,n,r,i){super(e,n),this.baseColumn=r,this.range=i,this.size=n.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Eb(e)),e.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(e,n=!1){let r=e.map(i=>i===null?null:x(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return n?r:ol(r)}};var kb=Symbol.for("drizzle:isPgEnum");function Cb(t){return!!t&&typeof t=="function"&&kb in t&&t[kb]===!0}var Tb=class extends P{static[m]="PgEnumColumnBuilder";constructor(e,n){super(e,"string","PgEnumColumn"),this.config.enum=n}build(e){return new pl(e,this.config)}},pl=class extends S{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,n){super(e,n),this.enum=n.enum}getSQLType(){return this.enum.enumName}};var Se=class{static[m]="Subquery";constructor(e,n,r,i=!1){this._={brand:"Subquery",sql:e,selectedFields:n,alias:r,isWith:i}}},Ir=class extends Se{static[m]="WithSubquery"};var Ab="0.39.3";var dl,fl,ie={startActiveSpan(t,e){return dl?(fl||(fl=dl.trace.getTracer("drizzle-orm",Ab)),Zs((n,r)=>r.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:n.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),dl,fl)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Js=Symbol.for("drizzle:Schema"),Xs=Symbol.for("drizzle:Columns"),Pb=Symbol.for("drizzle:ExtraConfigColumns"),ml=Symbol.for("drizzle:OriginalName"),hl=Symbol.for("drizzle:BaseName"),Zi=Symbol.for("drizzle:IsAlias"),qb=Symbol.for("drizzle:ExtraConfigBuilder"),Ib=Symbol.for("drizzle:IsDrizzleTable"),T=class{static[m]="Table";static Symbol={Name:St,Schema:Js,OriginalName:ml,Columns:Xs,ExtraConfigColumns:Pb,BaseName:hl,IsAlias:Zi,ExtraConfigBuilder:qb};[St];[ml];[Js];[Xs];[Pb];[hl];[Zi]=!1;[Ib]=!0;[qb]=void 0;constructor(e,n,r){this[St]=this[ml]=e,this[Js]=n,this[hl]=r}};function vl(t){return typeof t=="object"&&t!==null&&Ib in t}function Xe(t){return t[St]}function Pn(t){return`${t[Js]??"public"}.${t[St]}`}var jb=class{static[m]="FakePrimitiveParam"};function gl(t){return t!=null&&typeof t.getSQL=="function"}function L5(t){let e={sql:"",params:[]};for(let n of t)e.sql+=n.sql,e.params.push(...n.params),n.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...n.typings));return e}var _e=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new C([this])}},C=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=Ob;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ie.startActiveSpan("drizzle.buildSQL",n=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return n?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,n){let r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:c,paramStartIndex:u}=r;return L5(e.map(l=>{if(x(l,_e))return{sql:l.value.join(""),params:[]};if(x(l,Ji))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new _e("(")];for(let[d,f]of l.entries())p.push(f),d<l.length-1&&p.push(new _e(", "));return p.push(new _e(")")),this.buildQueryFromSourceParams(p,r)}if(x(l,t))return this.buildQueryFromSourceParams(l.queryChunks,{...r,inlineParams:c||l.shouldInlineParams});if(x(l,T)){let p=l[T.Symbol.Schema],d=l[T.Symbol.Name];return{sql:p===void 0||l[Zi]?a(d):a(p)+"."+a(d),params:[]}}if(x(l,G)){let p=i.getColumnCasing(l);if(n.invokeSource==="indexes")return{sql:a(p),params:[]};let d=l.table[T.Symbol.Schema];return{sql:l.table[Zi]||d===void 0?a(l.table[T.Symbol.Name])+"."+a(p):a(d)+"."+a(l.table[T.Symbol.Name])+"."+a(p),params:[]}}if(x(l,Qe)){let p=l[ae].schema,d=l[ae].name;return{sql:p===void 0||l[ae].isAlias?a(d):a(p)+"."+a(d),params:[]}}if(x(l,Ye)){if(x(l.value,Ft))return{sql:s(u.value++,l),params:[l],typings:["none"]};let p=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(x(p,t))return this.buildQueryFromSourceParams([p],r);if(c)return{sql:this.mapInlineParam(p,r),params:[]};let d=["none"];return o&&(d=[o(l.encoder)]),{sql:s(u.value++,p),params:[p],typings:d}}return x(l,Ft)?{sql:s(u.value++,l),params:[l],typings:["none"]}:x(l,t.Aliased)&&l.fieldAlias!==void 0?{sql:a(l.fieldAlias),params:[]}:x(l,Se)?l._.isWith?{sql:a(l._.alias),params:[]}:this.buildQueryFromSourceParams([new _e("("),l._.sql,new _e(") "),new Ji(l._.alias)],r):Cb(l)?l.schema?{sql:a(l.schema)+"."+a(l.enumName),params:[]}:{sql:a(l.enumName),params:[]}:gl(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],r):this.buildQueryFromSourceParams([new _e("("),l.getSQL(),new _e(")")],r):c?{sql:this.mapInlineParam(l,r),params:[]}:{sql:s(u.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:n}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return n(e);if(typeof e=="object"){let r=e.toString();return n(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},Ji=class{constructor(e){this.value=e}static[m]="Name";brand;getSQL(){return new C([this])}};function Nb(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Ob={mapFromDriverValue:t=>t},Rb={mapToDriverValue:t=>t},QN={...Ob,...Rb},Ye=class{constructor(e,n=Rb){this.value=e,this.encoder=n}static[m]="Param";brand;getSQL(){return new C([this])}};function h(t,...e){let n=[];(e.length>0||t.length>0&&t[0]!=="")&&n.push(new _e(t[0]));for(let[r,i]of e.entries())n.push(i,new _e(t[r+1]));return new C(n)}(t=>{function e(){return new C([])}t.empty=e;function n(c){return new C(c)}t.fromList=n;function r(c){return new C([new _e(c)])}t.raw=r;function i(c,u){let l=[];for(let[p,d]of c.entries())p>0&&u!==void 0&&l.push(u),l.push(d);return new C(l)}t.join=i;function a(c){return new Ji(c)}t.identifier=a;function s(c){return new Ft(c)}t.placeholder=s;function o(c,u){return new Ye(c,u)}t.param=o})(h||(h={}));(t=>{class e{constructor(r,i){this.sql=r,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(C||(C={}));var Ft=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new C([this])}};function yl(t,e){return t.map(n=>{if(x(n,Ft)){if(!(n.name in e))throw new Error(`No value for placeholder "${n.name}" was provided`);return e[n.name]}if(x(n,Ye)&&x(n.value,Ft)){if(!(n.value.name in e))throw new Error(`No value for placeholder "${n.value.name}" was provided`);return n.encoder.mapToDriverValue(e[n.value.name])}return n})}var Db=Symbol.for("drizzle:IsDrizzleView"),Qe=class{static[m]="View";[ae];[Db]=!0;constructor({name:e,schema:n,selectedFields:r,query:i}){this[ae]={name:e,originalName:e,schema:n,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new C([this])}};function Mb(t){return typeof t=="object"&&t!==null&&Db in t}G.prototype.getSQL=function(){return new C([this])};T.prototype.getSQL=function(){return new C([this])};Se.prototype.getSQL=function(){return new C([this])};var qn=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,n){return n==="table"?this.table:e[n]}},jr=class{constructor(e,n){this.alias=e,this.replaceOriginalName=n}static[m]="TableAliasProxyHandler";get(e,n){if(n===T.Symbol.IsAlias)return!0;if(n===T.Symbol.Name)return this.alias;if(this.replaceOriginalName&&n===T.Symbol.OriginalName)return this.alias;if(n===ae)return{...e[ae],name:this.alias,isAlias:!0};if(n===T.Symbol.Columns){let i=e[T.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new qn(new Proxy(e,this)))}),a}let r=e[n];return x(r,G)?new Proxy(r,new qn(new Proxy(e,this))):r}},Bb=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,n){return n==="sourceTable"?Xi(e.sourceTable,this.alias):e[n]}};function Xi(t,e){return new Proxy(t,new jr(e,!1))}function jt(t,e){return new Proxy(t,new qn(new Proxy(t.table,new jr(e,!1))))}function xl(t,e){return new C.Aliased(Yi(t.sql,e),t.fieldAlias)}function Yi(t,e){return h.join(t.queryChunks.map(n=>x(n,G)?jt(n,e):x(n,C)?Yi(n,e):x(n,C.Aliased)?xl(n,e):n))}var ea=class extends Error{static[m]="DrizzleError";constructor({message:e,cause:n}){super(e),this.name="DrizzleError",this.cause=n}},Ys=class extends ea{static[m]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function et(t,e){return Nb(e)&&!gl(t)&&!x(t,Ye)&&!x(t,Ft)&&!x(t,G)&&!x(t,T)&&!x(t,Qe)?new Ye(t,e):t}var ee=(t,e)=>h`${t} = ${et(e,t)}`,Fb=(t,e)=>h`${t} <> ${et(e,t)}`;function nn(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" and ")),new _e(")")])}function Lb(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" or ")),new _e(")")])}function zb(t){return h`not ${t}`}var $b=(t,e)=>h`${t} > ${et(e,t)}`,Ub=(t,e)=>h`${t} >= ${et(e,t)}`,Qb=(t,e)=>h`${t} < ${et(e,t)}`,Vb=(t,e)=>h`${t} <= ${et(e,t)}`;function Hb(t,e){return Array.isArray(e)?e.length===0?h`false`:h`${t} in ${e.map(n=>et(n,t))}`:h`${t} in ${et(e,t)}`}function Gb(t,e){return Array.isArray(e)?e.length===0?h`true`:h`${t} not in ${e.map(n=>et(n,t))}`:h`${t} not in ${et(e,t)}`}function Kb(t){return h`${t} is null`}function Wb(t){return h`${t} is not null`}function Zb(t){return h`exists ${t}`}function Jb(t){return h`not exists ${t}`}function Xb(t,e,n){return h`${t} between ${et(e,t)} and ${et(n,t)}`}function Yb(t,e,n){return h`${t} not between ${et(e,t)} and ${et(n,t)}`}function e0(t,e){return h`${t} like ${e}`}function t0(t,e){return h`${t} not like ${e}`}function n0(t,e){return h`${t} ilike ${e}`}function r0(t,e){return h`${t} not ilike ${e}`}function i0(t){return h`${t} asc`}function ta(t){return h`${t} desc`}var bl=class{static[m]="ConsoleLogWriter";write(e){console.log(e)}},eo=class{static[m]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new bl}logQuery(e,n){let r=n.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},to=class{static[m]="NoopLogger";logQuery(){}};var Re=class{static[m]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(n=>(e?.(),n),n=>{throw e?.(),n})}then(e,n){return this.execute().then(e,n)}};function a0(t,e,n){let r={},i=t.reduce((a,{path:s,field:o},c)=>{let u;x(o,G)?u=o:x(o,C)?u=o.decoder:u=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p<s.length-1)d in l||(l[d]={}),l=l[d];else{let f=e[c],v=l[d]=f===null?null:u.mapFromDriverValue(f);if(n&&x(o,G)&&s.length===2){let y=s[0];y in r?typeof r[y]=="string"&&r[y]!==Xe(o.table)&&(r[y]=!1):r[y]=v===null?Xe(o.table):!1}}return a},{});if(n&&Object.keys(r).length>0)for(let[a,s]of Object.entries(r))typeof s=="string"&&!n[s]&&(i[a]=null);return i}function dt(t,e){return Object.entries(t).reduce((n,[r,i])=>{if(typeof r!="string")return n;let a=e?[...e,r]:[r];return x(i,G)||x(i,C)||x(i,C.Aliased)?n.push({path:a,field:i}):x(i,T)?n.push(...dt(i[T.Symbol.Columns],a)):n.push(...dt(i,a)),n},[])}function na(t,e){let n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let[i,a]of n.entries())if(a!==r[i])return!1;return!0}function no(t,e){let n=Object.entries(e).filter(([,r])=>r!==void 0).map(([r,i])=>x(i,C)||x(i,G)?[r,i]:[r,new Ye(i,t[T.Symbol.Columns][r])]);if(n.length===0)throw new Error("No values to set");return Object.fromEntries(n)}function s0(t,e){for(let n of e)for(let r of Object.getOwnPropertyNames(n.prototype))r!=="constructor"&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(n.prototype,r)||Object.create(null))}function ro(t){return t[T.Symbol.Columns]}function o0(t){return t[ae].selectedFields}function Lt(t){return x(t,Se)?t._.alias:x(t,Qe)?t[ae].name:x(t,C)?void 0:t[T.Symbol.IsAlias]?t[T.Symbol.Name]:t[T.Symbol.BaseName]}function U(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function c0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var zt=class extends P{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var wl=class extends zt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new Sl(e,this.config)}},Sl=class extends S{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},_l=class extends zt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new El(e,this.config)}},El=class extends S{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function u0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new wl(n):new _l(n)}var kl=class extends P{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Tl(e,this.config)}},Tl=class extends S{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},Cl=class extends P{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new Al(e,this.config)}},Al=class extends S{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function l0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new kl(n):new Cl(n)}var Pl=class extends P{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ql(e,this.config)}},ql=class extends S{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Nr(t){return new Pl(t??"")}var Il=class extends P{static[m]="PgCharBuilder";constructor(e,n){super(e,"string","PgChar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new jl(e,this.config)}},jl=class extends S{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function p0(t,e={}){let{name:n,config:r}=U(t,e);return new Il(n,r)}var Nl=class extends P{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new Ol(e,this.config)}},Ol=class extends S{static[m]="PgCidr";getSQLType(){return"cidr"}};function d0(t){return new Nl(t??"")}var Rl=class extends P{static[m]="PgCustomColumnBuilder";constructor(e,n,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=n,this.config.customTypeParams=r}build(e){return new Dl(e,this.config)}},Dl=class extends S{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,n){super(e,n),this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function f0(t){return(e,n)=>{let{name:r,config:i}=U(e,n);return new Rl(r,i,t)}}var Nt=class extends P{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(h`now()`)}};var Ml=class extends Nt{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new ra(e,this.config)}},ra=class extends S{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Bl=class extends Nt{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ia(e,this.config)}},ia=class extends S{static[m]="PgDateString";getSQLType(){return"date"}};function m0(t,e){let{name:n,config:r}=U(t,e);return r?.mode==="date"?new Ml(n):new Bl(n)}var Fl=class extends P{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Ll(e,this.config)}},Ll=class extends S{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function h0(t){return new Fl(t??"")}var zl=class extends P{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new $l(e,this.config)}},$l=class extends S{static[m]="PgInet";getSQLType(){return"inet"}};function v0(t){return new zl(t??"")}var Ul=class extends zt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Ql(e,this.config)}},Ql=class extends S{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Or(t){return new Ul(t??"")}var Vl=class extends P{static[m]="PgIntervalBuilder";constructor(e,n){super(e,"string","PgInterval"),this.config.intervalConfig=n}build(e){return new Hl(e,this.config)}},Hl=class extends S{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${e}${n}`}};function g0(t,e={}){let{name:n,config:r}=U(t,e);return new Vl(n,r)}var Gl=class extends P{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new aa(e,this.config)}},aa=class extends S{static[m]="PgJson";constructor(e,n){super(e,n)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function y0(t){return new Gl(t??"")}var Kl=class extends P{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new sa(e,this.config)}},sa=class extends S{static[m]="PgJsonb";constructor(e,n){super(e,n)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function oa(t){return new Kl(t??"")}var Wl=class extends P{static[m]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Zl(e,this.config)}},Zl=class extends S{static[m]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Jl=class extends P{static[m]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Xl(e,this.config)}},Xl=class extends S{static[m]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(n),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function x0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new Wl(n):new Jl(n)}var Yl=class extends P{static[m]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new ep(e,this.config)}},ep=class extends S{static[m]="PgMacaddr";getSQLType(){return"macaddr"}};function b0(t){return new Yl(t??"")}var tp=class extends P{static[m]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new np(e,this.config)}},np=class extends S{static[m]="PgMacaddr8";getSQLType(){return"macaddr8"}};function w0(t){return new tp(t??"")}var rp=class extends P{static[m]="PgNumericBuilder";constructor(e,n,r){super(e,"string","PgNumeric"),this.config.precision=n,this.config.scale=r}build(e){return new ca(e,this.config)}},ca=class extends S{static[m]="PgNumeric";precision;scale;constructor(e,n){super(e,n),this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function S0(t,e){let{name:n,config:r}=U(t,e);return new rp(n,r?.precision,r?.scale)}var ip=class extends P{static[m]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new ap(e,this.config)}},ap=class extends S{static[m]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},sp=class extends P{static[m]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new op(e,this.config)}},op=class extends S{static[m]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(n),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function _0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new ip(n):new sp(n)}function z5(t){let e=[];for(let n=0;n<t.length;n+=2)e.push(Number.parseInt(t.slice(n,n+2),16));return new Uint8Array(e)}function E0(t,e){let n=new ArrayBuffer(8),r=new DataView(n);for(let i=0;i<8;i++)r.setUint8(i,t[e+i]);return r.getFloat64(0,!0)}function cp(t){let e=z5(t),n=0,r=e[n];n+=1;let i=new DataView(e.buffer),a=i.getUint32(n,r===1);n+=4;let s;if(a&536870912&&(s=i.getUint32(n,r===1),n+=4),(a&65535)===1){let o=E0(e,n);n+=8;let c=E0(e,n);return n+=8,[o,c]}throw new Error("Unsupported geometry type")}var up=class extends P{static[m]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new lp(e,this.config)}},lp=class extends S{static[m]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return cp(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},pp=class extends P{static[m]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new dp(e,this.config)}},dp=class extends S{static[m]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let n=cp(e);return{x:n[0],y:n[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function k0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new up(n):new pp(n)}var fp=class extends P{static[m]="PgRealBuilder";constructor(e,n){super(e,"number","PgReal"),this.config.length=n}build(e){return new mp(e,this.config)}},mp=class extends S{static[m]="PgReal";constructor(e,n){super(e,n)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function T0(t){return new fp(t??"")}var hp=class extends P{static[m]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new vp(e,this.config)}},vp=class extends S{static[m]="PgSerial";getSQLType(){return"serial"}};function C0(t){return new hp(t??"")}var gp=class extends zt{static[m]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new yp(e,this.config)}},yp=class extends S{static[m]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function A0(t){return new gp(t??"")}var xp=class extends P{static[m]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new bp(e,this.config)}},bp=class extends S{static[m]="PgSmallSerial";getSQLType(){return"smallserial"}};function P0(t){return new xp(t??"")}var wp=class extends P{static[m]="PgTextBuilder";constructor(e,n){super(e,"string","PgText"),this.config.enumValues=n.enum}build(e){return new Sp(e,this.config)}},Sp=class extends S{static[m]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function _t(t,e={}){let{name:n,config:r}=U(t,e);return new wp(n,r)}var _p=class extends Nt{constructor(e,n,r){super(e,"string","PgTime"),this.withTimezone=n,this.precision=r,this.config.withTimezone=n,this.config.precision=r}static[m]="PgTimeBuilder";build(e){return new ua(e,this.config)}},ua=class extends S{static[m]="PgTime";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function q0(t,e={}){let{name:n,config:r}=U(t,e);return new _p(n,r.withTimezone??!1,r.precision)}var Ep=class extends Nt{static[m]="PgTimestampBuilder";constructor(e,n,r){super(e,"date","PgTimestamp"),this.config.withTimezone=n,this.config.precision=r}build(e){return new la(e,this.config)}},la=class extends S{static[m]="PgTimestamp";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},kp=class extends Nt{static[m]="PgTimestampStringBuilder";constructor(e,n,r){super(e,"string","PgTimestampString"),this.config.withTimezone=n,this.config.precision=r}build(e){return new pa(e,this.config)}},pa=class extends S{static[m]="PgTimestampString";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function In(t,e={}){let{name:n,config:r}=U(t,e);return r?.mode==="string"?new kp(n,r.withTimezone??!1,r.precision):new Ep(n,r?.withTimezone??!1,r?.precision)}var Tp=class extends P{static[m]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(h`gen_random_uuid()`)}build(e){return new da(e,this.config)}},da=class extends S{static[m]="PgUUID";getSQLType(){return"uuid"}};function I0(t){return new Tp(t??"")}var Cp=class extends P{static[m]="PgVarcharBuilder";constructor(e,n){super(e,"string","PgVarchar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new Ap(e,this.config)}},Ap=class extends S{static[m]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function ft(t,e={}){let{name:n,config:r}=U(t,e);return new Cp(n,r)}var Pp=class extends P{static[m]="PgBinaryVectorBuilder";constructor(e,n){super(e,"string","PgBinaryVector"),this.config.dimensions=n.dimensions}build(e){return new qp(e,this.config)}},qp=class extends S{static[m]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function j0(t,e){let{name:n,config:r}=U(t,e);return new Pp(n,r)}var Ip=class extends P{static[m]="PgHalfVectorBuilder";constructor(e,n){super(e,"array","PgHalfVector"),this.config.dimensions=n.dimensions}build(e){return new jp(e,this.config)}},jp=class extends S{static[m]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function N0(t,e){let{name:n,config:r}=U(t,e);return new Ip(n,r)}var Np=class extends P{static[m]="PgSparseVectorBuilder";constructor(e,n){super(e,"string","PgSparseVector"),this.config.dimensions=n.dimensions}build(e){return new Op(e,this.config)}},Op=class extends S{static[m]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function O0(t,e){let{name:n,config:r}=U(t,e);return new Np(n,r)}var Rp=class extends P{static[m]="PgVectorBuilder";constructor(e,n){super(e,"array","PgVector"),this.config.dimensions=n.dimensions}build(e){return new Dp(e,this.config)}},Dp=class extends S{static[m]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function R0(t,e){let{name:n,config:r}=U(t,e);return new Rp(n,r)}function D0(){return{bigint:u0,bigserial:l0,boolean:Nr,char:p0,cidr:d0,customType:f0,date:m0,doublePrecision:h0,inet:v0,integer:Or,interval:g0,json:y0,jsonb:oa,line:x0,macaddr:b0,macaddr8:w0,numeric:S0,point:_0,geometry:k0,real:T0,serial:C0,smallint:A0,smallserial:P0,text:_t,time:q0,timestamp:In,uuid:I0,varchar:ft,bit:j0,halfvec:N0,sparsevec:O0,vector:R0}}var Mp=Symbol.for("drizzle:PgInlineForeignKeys"),M0=Symbol.for("drizzle:EnableRLS"),je=class extends T{static[m]="PgTable";static Symbol=Object.assign({},T.Symbol,{InlineForeignKeys:Mp,EnableRLS:M0});[Mp]=[];[M0]=!1;[T.Symbol.ExtraConfigBuilder]=void 0};function $5(t,e,n,r,i=t){let a=new je(t,r,i),s=typeof e=="function"?e(D0()):e,o=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.build(a);return a[Mp].push(...d.buildForeignKeys(f,a)),[l,f]})),c=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.buildExtraConfigColumn(a);return[l,f]})),u=Object.assign(a,o);return u[T.Symbol.Columns]=o,u[T.Symbol.ExtraConfigColumns]=c,n&&(u[je.Symbol.ExtraConfigBuilder]=n),Object.assign(u,{enableRLS:()=>(u[je.Symbol.EnableRLS]=!0,u)})}var fa=(t,e,n)=>$5(t,e,n,void 0);var io=class{static[m]="PgPrimaryKeyBuilder";columns;name;constructor(e,n){this.columns=e,this.name=n}build(e){return new Bp(e,this.columns,this.name)}},Bp=class{constructor(e,n,r){this.table=e,this.columns=n,this.name=r}static[m]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[je.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};var ao=class{constructor(e,n,r){this.sourceTable=e,this.referencedTable=n,this.relationName=r,this.referencedTableName=n[T.Symbol.Name]}static[m]="Relation";referencedTableName;fieldName},so=class{constructor(e,n){this.table=e,this.config=n}static[m]="Relations"},rn=class t extends ao{constructor(e,n,r,i){super(e,n,r?.relationName),this.config=r,this.isNullable=i}static[m]="One";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return n.fieldName=e,n}},ma=class t extends ao{constructor(e,n,r){super(e,n,r?.relationName),this.config=r}static[m]="Many";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,th/app/dist/index.cjs:64
pollmetry-app  | `);Ra.write(kw.format.apply(kw,e))}}Object.defineProperty(Ht.exports,"isWin",{get:function(){return Bo},set:function(t){Bo=t}});Ht.exports.warnTo=function(t){var e=Ra;return Ra=t,e};Ht.exports.getFileName=function(t){var e=t||process.env,n=e.PGPASSFILE||(Bo?Ew.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ew.join(e.HOME||"./",".pgpass"));return n};Ht.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Bo?!0:(e=e||"<unkn>",a9(t.mode)?t.mode&(t9|n9)?(Hd('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hd('WARNING: password file "%s" is not a plain file',e),!1))};var o9=Ht.exports.match=function(t,e){return ei.slice(0,-1).reduce(function(n,r,i){return i==1&&Number(t[r]||e9)===Number(e[r])?n&&!0:n&&(e[r]==="*"||e[r]===t[r])},!0)};Ht.exports.getPassword=function(t,e,n){var r,i=e.pipe(Yq());function a(c){var u=c9(c);u&&u9(u)&&o9(t,u)&&(r=u[s9],i.end())}var s=function(){e.destroy(),n(r)},o=function(c){e.destroy(),Hd("WARNING: error on reading file: %s",c),n(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var c9=Ht.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",n="",r=0,i=0,a=0,s={},o=!1,c=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[ei[l]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),n=t.charAt(u),o=r==Vd-1,o){c(r,i);break}u>=0&&e==":"&&n!=="\\"&&(c(r,i,u+1),i=u+2,r+=1)}return s=Object.keys(s).length===Vd?s:null,s},u9=Ht.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},n=0;n<ei.length;n+=1){var r=e[n],i=t[ei[n]]||"",a=r(i);if(!a)return!1}return!0}});var Aw=g((CF,Gd)=>{"use strict";var TF=require("path"),Cw=require("fs"),Fo=Tw();Gd.exports=function(t,e){var n=Fo.getFileName();Cw.stat(n,function(r,i){if(r||!Fo.usePgPass(i,n))return e(void 0);var a=Cw.createReadStream(n);Fo.getPassword(t,a,e)})};Gd.exports.warnTo=Fo.warnTo});var jw=g((AF,Iw)=>{"use strict";var l9=require("events").EventEmitter,Pw=Wr(),Kd=W1(),p9=Io(),d9=vd(),qw=cw(),f9=Na(),m9=Qd(),h9=fd(),Lo=class extends l9{constructor(e){super(),this.connectionParameters=new d9(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let n=e||{};this._Promise=n.Promise||global.Promise,this._types=new p9(n.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!n.enableChannelBinding,this.connection=n.connection||new m9({stream:n.stream,ssl:this.connectionParameters.ssl,keepAlive:n.keepAlive||!1,keepAliveInitialDelayMillis:n.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=n.binary||f9.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=n.connectionTimeoutMillis||0}_errorAllQueries(e){let n=r=>{process.nextTick(()=>{r.handleError(e,this.connection)})};this.activeQuery&&(n(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(n),this.queryQueue.length=0}_connect(e){let n=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{r._ending=!0,r.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){n.ssl?r.requestSsl():r.startup(n.getStartupConf())}),r.on("sslconnect",function(){r.startup(n.getStartupConf())}),this._attachListeners(r),r.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((n,r)=>{this._connect(i=>{i?r(i):n()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let n=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(r=>{if(r!==void 0){if(typeof r!="string"){n.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()}).catch(r=>{n.emit("error",r)});else if(this.password!==null)e();else try{Aw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(r){this.emit("error",r)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let n=await h9.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(n)}catch(n){this.emit("error",n)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Kd.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(n){this.connection.emit("error",n)}})}async _handleAuthSASLContinue(e){try{await Kd.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(n){this.connection.emit("error",n)}}_handleAuthSASLFinal(e){try{Kd.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(n){this.connection.emit("error",n)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:n}=this;this.activeQuery=null,this.readyForQuery=!0,n&&n.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let n=this.activeQuery;if(!n){this._handleErrorEvent(e);return}this.activeQuery=null,n.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let n=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(n);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,n={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(n.application_name=r),e.replication&&(n.replication=""+e.replication),e.statement_timeout&&(n.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(n.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(n.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(n.options=e.options),n}cancel(e,n){if(e.activeQuery===n){let r=this.connection;this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){r.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(n)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(n),1)}setTypeParser(e,n,r){return this._types.setTypeParser(e,n,r)}getTypeParser(e,n){return this._types.getTypeParser(e,n)}escapeIdentifier(e){return Pw.escapeIdentifier(e)}escapeLiteral(e){return Pw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,n,r){let i,a,s,o,c;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof n=="function"&&(i.callback=i.callback||n)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new qw(e,n,r),i.callback||(a=new this._Promise((u,l)=>{i.callback=(p,d)=>p?l(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),s&&(c=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),c(u),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(n=>{this.connection.once("end",n)})}};Lo.Query=qw;Iw.exports=Lo});var Dw=g((PF,Rw)=>{"use strict";var v9=require("events").EventEmitter,Nw=function(){},Ow=(t,e)=>{let n=t.findIndex(e);return n===-1?void 0:t.splice(n,1)[0]},Wd=class{constructor(e,n,r){this.client=e,this.idleListener=n,this.timeoutId=r}},ti=class{constructor(e){this.callback=e}};function g9(){throw new Error("Release called on client which has already been released to the pool.")}function zo(t,e){if(e)return{callback:e,result:void 0};let n,r,i=function(s,o){s?n(s):r(o)},a=new t(function(s,o){r=s,n=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function y9(t,e){return function n(r){r.client=e,e.removeListener("error",n),e.on("error",()=>{t.log("additional client error after disconnection due to error",r)}),t._remove(e),t.emit("error",r,e)}}var Zd=class extends v9{constructor(e,n){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||n||Jd().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(n=>{this._remove(n.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let n=this._idle.pop();clearTimeout(n.timeoutId);let r=n.client;r.ref&&r.ref();let i=n.idleListener;return this._acquireClient(r,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,n){let r=Ow(this._idle,a=>a.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof n=="function"&&n()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let n=zo(this.Promise,e),r=n.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ti(n.callback)),r;let i=(o,c,u)=>{clearTimeout(s),n.callback(o,c,u)},a=new ti(i),s=setTimeout(()=>{Ow(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,n.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),r}return this.newClient(new ti(n.callback)),r}newClient(e){let n=new this.Client(this.options);this._clients.push(n);let r=y9(this,n);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,n.connection?n.connection.stream.destroy():n.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),n.connect(s=>{if(i&&clearTimeout(i),n.on("error",r),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==n),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,Nw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(n),this._idle.findIndex(u=>u.client===n)!==-1&&this._acquireClient(n,new ti((u,l,p)=>p()),r,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),n.once("end",()=>clearTimeout(o))}return this._acquireClient(n,e,r,!0)}})}_acquireClient(e,n,r,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,r),e.removeListener("error",r),n.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),n.callback(a,void 0,Nw);n.callback(void 0,e,e.release)}):n.callback(void 0,e,e.release)}_releaseOnce(e,n){let r=!1;return i=>{r&&g9(),r=!0,this._release(e,n,i)}}_release(e,n,r){if(e.on("error",n),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",r,e),r||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Wd(e,n,a)),this._pulseQueue()}query(e,n,r){if(typeof e=="function"){let a=zo(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof n=="function"&&(r=n,n=void 0);let i=zo(this.Promise,r);return r=i.callback,this.connect((a,s)=>{if(a)return r(a);let o=!1,c=u=>{o||(o=!0,s.release(u),r(u))};s.once("error",c),this.log("dispatching query");try{s.query(e,n,(u,l)=>{if(this.log("query dispatched"),s.removeListener("error",c),!o)return o=!0,s.release(u),u?r(u):r(void 0,l)})}catch(u){return s.release(u),r(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let r=new Error("Called end on pool more than once");return e?e(r):this.Promise.reject(r)}this.ending=!0;let n=zo(this.Promise,e);return this._endCallback=n.callback,this._pulseQueue(),n.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,n)=>e+(this._expired.has(n)?1:0),0)}get totalCount(){return this._clients.length}};Rw.exports=Zd});var Fw=g((qF,Bw)=>{"use strict";var Mw=require("events").EventEmitter,x9=require("util"),Xd=Wr(),ni=Bw.exports=function(t,e,n){Mw.call(this),t=Xd.normalizeQueryConfig(t,e,n),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(r){r==="row"&&(this._emitRowEvents=!0)}.bind(this))};x9.inherits(ni,Mw);var b9={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};ni.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let n in e){let r=b9[n]||n;t[r]=e[n]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};ni.prototype.then=function(t,e){return this._getPromise().then(t,e)};ni.prototype.catch=function(t){return this._getPromise().catch(t)};ni.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};ni.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let n=function(r,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),r)return e.handleError(r);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(c=>{e.emit("row",c,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(n=process.domain.bind(n)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let r=(this.values||[]).map(Xd.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return n(i)}return t.native.execute(this.name,r,n)}return t.native.prepare(this.name,this.text,r.length,function(i){return i?n(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,r,n))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return n(i)}let r=this.values.map(Xd.prepareValue);t.native.query(this.text,r,n)}else this.queryMode==="extended"?t.native.query(this.text,[],n):t.native.query(this.text,n)}});var Qw=g((IF,Uw)=>{"use strict";var Lw;try{Lw=require("pg-native")}catch(t){throw t}var w9=Io(),zw=require("events").EventEmitter,S9=require("util"),_9=vd(),$w=Fw(),rt=Uw.exports=function(t){zw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new w9(t.types),this.native=new Lw({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new _9(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};rt.Query=$w;S9.inherits(rt,zw);rt.prototype._errorAllQueries=function(t){let e=n=>{process.nextTick(()=>{n.native=this.native,n.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};rt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(n,r){if(e.connectionParameters.nativeConnectionString&&(r=e.connectionParameters.nativeConnectionString),n)return t(n);e.native.connect(r,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};rt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,n)=>{this._connect(r=>{r?n(r):e()})})};rt.prototype.query=function(t,e,n){let r,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=r=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,r=new $w(t,e,n),!r.callback){let c,u;i=new this._Promise((l,p)=>{c=l,u=p}).catch(l=>{throw Error.captureStackTrace(l),l}),r.callback=(l,p)=>l?u(l):c(p)}return a&&(o=r.callback,s=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{r.handleError(c,this.connection)}),o(c),r.callback=()=>{};let u=this._queryQueue.indexOf(r);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),r.callback=(c,u)=>{clearTimeout(s),o(c,u)}),this._queryable?this._ending?(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(r),this._pulseQueryQueue(),i):(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};rt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let n;return t||(n=new this._Promise(function(r,i){t=a=>a?i(a):r()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),n};rt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};rt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let n=this;e.once("_done",function(){n._pulseQueryQueue()})};rt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};rt.prototype.ref=function(){};rt.prototype.unref=function(){};rt.prototype.setTypeParser=function(t,e,n){return this._types.setTypeParser(t,e,n)};rt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Yd=g((jF,Vw)=>{"use strict";Vw.exports=Qw()});var Jd=g((OF,Da)=>{"use strict";var E9=jw(),k9=Na(),T9=Qd(),C9=yd(),A9=Wr(),P9=Dw(),q9=Io(),{DatabaseError:I9}=zd(),{escapeIdentifier:j9,escapeLiteral:N9}=Wr(),O9=t=>class extends P9{constructor(n){super(n,t)}},ef=function(t){this.defaults=k9,this.Client=t,this.Query=this.Client.Query,this.Pool=O9(this.Client),this._pools=[],this.Connection=T9,this.types=ja(),this.DatabaseError=I9,this.TypeOverrides=q9,this.escapeIdentifier=j9,this.escapeLiteral=N9,this.Result=C9,this.utils=A9};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Da.exports=new ef(Yd()):(Da.exports=new ef(E9),Object.defineProperty(Da.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new ef(Yd())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Da.exports,"native",{value:t}),t}}))});var B9={};df(B9,{log:()=>lf});module.exports=oS(B9);var Vo=ai(nl(),1);var Ww=require("socket.io");var Jp={};df(Jp,{EMOJIS:()=>T3,insertQuestionSchema:()=>E3,insertSessionSchema:()=>Zp,insertUserSchema:()=>Wp,insertVoteEventSchema:()=>k3,questionStateEnum:()=>x3,questionTypeEnum:()=>b3,questions:()=>te,questionsRelations:()=>w3,segmentEnum:()=>S3,sessions:()=>oe,sessionsRelations:()=>y3,users:()=>He,usersRelations:()=>g3,voteEvents:()=>de,voteEventsRelations:()=>_3});var m=Symbol.for("drizzle:entityKind"),tN=Symbol.for("drizzle:hasOwnEntityKind");function x(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=Object.getPrototypeOf(t).constructor;if(n)for(;n;){if(m in n&&n[m]===e[m])return!0;n=Object.getPrototypeOf(n)}return!1}var G=class{constructor(e,n){this.table=e,this.config=n,this.name=n.name,this.keyAsName=n.keyAsName,this.notNull=n.notNull,this.default=n.default,this.defaultFn=n.defaultFn,this.onUpdateFn=n.onUpdateFn,this.hasDefault=n.hasDefault,this.primary=n.primaryKey,this.isUnique=n.isUnique,this.uniqueName=n.uniqueName,this.uniqueType=n.uniqueType,this.dataType=n.dataType,this.columnType=n.columnType,this.generated=n.generated,this.generatedIdentity=n.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Ks=class{static[m]="ColumnBuilder";config;constructor(e,n,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:n,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var St=Symbol.for("drizzle:Name");var Ws=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,n){this.reference=()=>{let{name:r,columns:i,foreignColumns:a}=e();return{name:r,columns:i,foreignTable:a[0].table,foreignColumns:a}},n&&(this._onUpdate=n.onUpdate,this._onDelete=n.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new rl(e,this)}},rl=class{constructor(e,n){this.table=e,this.reference=n.reference,this.onUpdate=n._onUpdate,this.onDelete=n._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:n,foreignColumns:r}=this.reference(),i=n.map(o=>o.name),a=r.map(o=>o.name),s=[this.table[St],...i,r[0].table[St],...a];return e??`${s.join("_")}_fk`}};function Zs(t,...e){return t(...e)}function sl(t,e){return`${t[St]}_${e.join("_")}_unique`}var il=class{constructor(e,n){this.name=n,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new al(e,this.columns,this.nullsNotDistinctConfig,this.name)}},wb=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new il(e,this.name)}},al=class{constructor(e,n,r,i){this.table=e,this.columns=n,this.name=i??sl(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=r}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Sb(t,e,n){for(let r=e;r<t.length;r++){let i=t[r];if(i==="\\"){r++;continue}if(i==='"')return[t.slice(e,r).replace(/\\/g,""),r+1];if(!n&&(i===","||i==="}"))return[t.slice(e,r).replace(/\\/g,""),r]}return[t.slice(e).replace(/\\/g,""),t.length]}function _b(t,e=0){let n=[],r=e,i=!1;for(;r<t.length;){let a=t[r];if(a===","){(i||r===e)&&n.push(""),i=!0,r++;continue}if(i=!1,a==="\\"){r+=2;continue}if(a==='"'){let[c,u]=Sb(t,r+1,!0);n.push(c),r=u;continue}if(a==="}")return[n,r+1];if(a==="{"){let[c,u]=_b(t,r+1);n.push(c),r=u;continue}let[s,o]=Sb(t,r,!1);n.push(s),r=o}return[n,r]}function Eb(t){let[e]=_b(t,1);return e}function ol(t){return`{${t.map(e=>Array.isArray(e)?ol(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var P=class extends Ks{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new ul(this.config.name,this,e)}references(e,n={}){return this.foreignKeyConfigs.push({ref:e,actions:n}),this}unique(e,n){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,n){return this.foreignKeyConfigs.map(({ref:r,actions:i})=>Zs((a,s)=>{let o=new Ws(()=>{let c=a();return{columns:[e],foreignColumns:[c]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(n)},r,i))}buildExtraConfigColumn(e){return new cl(e,this.config)}},S=class extends G{constructor(e,n){n.uniqueName||(n.uniqueName=sl(e,[n.name])),super(e,n),this.table=e}static[m]="PgColumn"},cl=class extends S{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},qr=class{static[m]="IndexedColumn";constructor(e,n,r,i){this.name=e,this.keyAsName=n,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},ul=class extends P{static[m]="PgArrayBuilder";constructor(e,n,r){super(e,"array","PgArray"),this.config.baseBuilder=n,this.config.size=r}build(e){let n=this.config.baseBuilder.build(e);return new ll(e,this.config,n)}},ll=class t extends S{constructor(e,n,r,i){super(e,n),this.baseColumn=r,this.range=i,this.size=n.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Eb(e)),e.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(e,n=!1){let r=e.map(i=>i===null?null:x(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return n?r:ol(r)}};var kb=Symbol.for("drizzle:isPgEnum");function Cb(t){return!!t&&typeof t=="function"&&kb in t&&t[kb]===!0}var Tb=class extends P{static[m]="PgEnumColumnBuilder";constructor(e,n){super(e,"string","PgEnumColumn"),this.config.enum=n}build(e){return new pl(e,this.config)}},pl=class extends S{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,n){super(e,n),this.enum=n.enum}getSQLType(){return this.enum.enumName}};var Se=class{static[m]="Subquery";constructor(e,n,r,i=!1){this._={brand:"Subquery",sql:e,selectedFields:n,alias:r,isWith:i}}},Ir=class extends Se{static[m]="WithSubquery"};var Ab="0.39.3";var dl,fl,ie={startActiveSpan(t,e){return dl?(fl||(fl=dl.trace.getTracer("drizzle-orm",Ab)),Zs((n,r)=>r.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:n.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),dl,fl)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Js=Symbol.for("drizzle:Schema"),Xs=Symbol.for("drizzle:Columns"),Pb=Symbol.for("drizzle:ExtraConfigColumns"),ml=Symbol.for("drizzle:OriginalName"),hl=Symbol.for("drizzle:BaseName"),Zi=Symbol.for("drizzle:IsAlias"),qb=Symbol.for("drizzle:ExtraConfigBuilder"),Ib=Symbol.for("drizzle:IsDrizzleTable"),T=class{static[m]="Table";static Symbol={Name:St,Schema:Js,OriginalName:ml,Columns:Xs,ExtraConfigColumns:Pb,BaseName:hl,IsAlias:Zi,ExtraConfigBuilder:qb};[St];[ml];[Js];[Xs];[Pb];[hl];[Zi]=!1;[Ib]=!0;[qb]=void 0;constructor(e,n,r){this[St]=this[ml]=e,this[Js]=n,this[hl]=r}};function vl(t){return typeof t=="object"&&t!==null&&Ib in t}function Xe(t){return t[St]}function Pn(t){return`${t[Js]??"public"}.${t[St]}`}var jb=class{static[m]="FakePrimitiveParam"};function gl(t){return t!=null&&typeof t.getSQL=="function"}function L5(t){let e={sql:"",params:[]};for(let n of t)e.sql+=n.sql,e.params.push(...n.params),n.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...n.typings));return e}var _e=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new C([this])}},C=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=Ob;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ie.startActiveSpan("drizzle.buildSQL",n=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return n?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,n){let r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:c,paramStartIndex:u}=r;return L5(e.map(l=>{if(x(l,_e))return{sql:l.value.join(""),params:[]};if(x(l,Ji))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new _e("(")];for(let[d,f]of l.entries())p.push(f),d<l.length-1&&p.push(new _e(", "));return p.push(new _e(")")),this.buildQueryFromSourceParams(p,r)}if(x(l,t))return this.buildQueryFromSourceParams(l.queryChunks,{...r,inlineParams:c||l.shouldInlineParams});if(x(l,T)){let p=l[T.Symbol.Schema],d=l[T.Symbol.Name];return{sql:p===void 0||l[Zi]?a(d):a(p)+"."+a(d),params:[]}}if(x(l,G)){let p=i.getColumnCasing(l);if(n.invokeSource==="indexes")return{sql:a(p),params:[]};let d=l.table[T.Symbol.Schema];return{sql:l.table[Zi]||d===void 0?a(l.table[T.Symbol.Name])+"."+a(p):a(d)+"."+a(l.table[T.Symbol.Name])+"."+a(p),params:[]}}if(x(l,Qe)){let p=l[ae].schema,d=l[ae].name;return{sql:p===void 0||l[ae].isAlias?a(d):a(p)+"."+a(d),params:[]}}if(x(l,Ye)){if(x(l.value,Ft))return{sql:s(u.value++,l),params:[l],typings:["none"]};let p=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(x(p,t))return this.buildQueryFromSourceParams([p],r);if(c)return{sql:this.mapInlineParam(p,r),params:[]};let d=["none"];return o&&(d=[o(l.encoder)]),{sql:s(u.value++,p),params:[p],typings:d}}return x(l,Ft)?{sql:s(u.value++,l),params:[l],typings:["none"]}:x(l,t.Aliased)&&l.fieldAlias!==void 0?{sql:a(l.fieldAlias),params:[]}:x(l,Se)?l._.isWith?{sql:a(l._.alias),params:[]}:this.buildQueryFromSourceParams([new _e("("),l._.sql,new _e(") "),new Ji(l._.alias)],r):Cb(l)?l.schema?{sql:a(l.schema)+"."+a(l.enumName),params:[]}:{sql:a(l.enumName),params:[]}:gl(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],r):this.buildQueryFromSourceParams([new _e("("),l.getSQL(),new _e(")")],r):c?{sql:this.mapInlineParam(l,r),params:[]}:{sql:s(u.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:n}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return n(e);if(typeof e=="object"){let r=e.toString();return n(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},Ji=class{constructor(e){this.value=e}static[m]="Name";brand;getSQL(){return new C([this])}};function Nb(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Ob={mapFromDriverValue:t=>t},Rb={mapToDriverValue:t=>t},QN={...Ob,...Rb},Ye=class{constructor(e,n=Rb){this.value=e,this.encoder=n}static[m]="Param";brand;getSQL(){return new C([this])}};function h(t,...e){let n=[];(e.length>0||t.length>0&&t[0]!=="")&&n.push(new _e(t[0]));for(let[r,i]of e.entries())n.push(i,new _e(t[r+1]));return new C(n)}(t=>{function e(){return new C([])}t.empty=e;function n(c){return new C(c)}t.fromList=n;function r(c){return new C([new _e(c)])}t.raw=r;function i(c,u){let l=[];for(let[p,d]of c.entries())p>0&&u!==void 0&&l.push(u),l.push(d);return new C(l)}t.join=i;function a(c){return new Ji(c)}t.identifier=a;function s(c){return new Ft(c)}t.placeholder=s;function o(c,u){return new Ye(c,u)}t.param=o})(h||(h={}));(t=>{class e{constructor(r,i){this.sql=r,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(C||(C={}));var Ft=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new C([this])}};function yl(t,e){return t.map(n=>{if(x(n,Ft)){if(!(n.name in e))throw new Error(`No value for placeholder "${n.name}" was provided`);return e[n.name]}if(x(n,Ye)&&x(n.value,Ft)){if(!(n.value.name in e))throw new Error(`No value for placeholder "${n.value.name}" was provided`);return n.encoder.mapToDriverValue(e[n.value.name])}return n})}var Db=Symbol.for("drizzle:IsDrizzleView"),Qe=class{static[m]="View";[ae];[Db]=!0;constructor({name:e,schema:n,selectedFields:r,query:i}){this[ae]={name:e,originalName:e,schema:n,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new C([this])}};function Mb(t){return typeof t=="object"&&t!==null&&Db in t}G.prototype.getSQL=function(){return new C([this])};T.prototype.getSQL=function(){return new C([this])};Se.prototype.getSQL=function(){return new C([this])};var qn=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,n){return n==="table"?this.table:e[n]}},jr=class{constructor(e,n){this.alias=e,this.replaceOriginalName=n}static[m]="TableAliasProxyHandler";get(e,n){if(n===T.Symbol.IsAlias)return!0;if(n===T.Symbol.Name)return this.alias;if(this.replaceOriginalName&&n===T.Symbol.OriginalName)return this.alias;if(n===ae)return{...e[ae],name:this.alias,isAlias:!0};if(n===T.Symbol.Columns){let i=e[T.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new qn(new Proxy(e,this)))}),a}let r=e[n];return x(r,G)?new Proxy(r,new qn(new Proxy(e,this))):r}},Bb=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,n){return n==="sourceTable"?Xi(e.sourceTable,this.alias):e[n]}};function Xi(t,e){return new Proxy(t,new jr(e,!1))}function jt(t,e){return new Proxy(t,new qn(new Proxy(t.table,new jr(e,!1))))}function xl(t,e){return new C.Aliased(Yi(t.sql,e),t.fieldAlias)}function Yi(t,e){return h.join(t.queryChunks.map(n=>x(n,G)?jt(n,e):x(n,C)?Yi(n,e):x(n,C.Aliased)?xl(n,e):n))}var ea=class extends Error{static[m]="DrizzleError";constructor({message:e,cause:n}){super(e),this.name="DrizzleError",this.cause=n}},Ys=class extends ea{static[m]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function et(t,e){return Nb(e)&&!gl(t)&&!x(t,Ye)&&!x(t,Ft)&&!x(t,G)&&!x(t,T)&&!x(t,Qe)?new Ye(t,e):t}var ee=(t,e)=>h`${t} = ${et(e,t)}`,Fb=(t,e)=>h`${t} <> ${et(e,t)}`;function nn(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" and ")),new _e(")")])}function Lb(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" or ")),new _e(")")])}function zb(t){return h`not ${t}`}var $b=(t,e)=>h`${t} > ${et(e,t)}`,Ub=(t,e)=>h`${t} >= ${et(e,t)}`,Qb=(t,e)=>h`${t} < ${et(e,t)}`,Vb=(t,e)=>h`${t} <= ${et(e,t)}`;function Hb(t,e){return Array.isArray(e)?e.length===0?h`false`:h`${t} in ${e.map(n=>et(n,t))}`:h`${t} in ${et(e,t)}`}function Gb(t,e){return Array.isArray(e)?e.length===0?h`true`:h`${t} not in ${e.map(n=>et(n,t))}`:h`${t} not in ${et(e,t)}`}function Kb(t){return h`${t} is null`}function Wb(t){return h`${t} is not null`}function Zb(t){return h`exists ${t}`}function Jb(t){return h`not exists ${t}`}function Xb(t,e,n){return h`${t} between ${et(e,t)} and ${et(n,t)}`}function Yb(t,e,n){return h`${t} not between ${et(e,t)} and ${et(n,t)}`}function e0(t,e){return h`${t} like ${e}`}function t0(t,e){return h`${t} not like ${e}`}function n0(t,e){return h`${t} ilike ${e}`}function r0(t,e){return h`${t} not ilike ${e}`}function i0(t){return h`${t} asc`}function ta(t){return h`${t} desc`}var bl=class{static[m]="ConsoleLogWriter";write(e){console.log(e)}},eo=class{static[m]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new bl}logQuery(e,n){let r=n.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},to=class{static[m]="NoopLogger";logQuery(){}};var Re=class{static[m]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(n=>(e?.(),n),n=>{throw e?.(),n})}then(e,n){return this.execute().then(e,n)}};function a0(t,e,n){let r={},i=t.reduce((a,{path:s,field:o},c)=>{let u;x(o,G)?u=o:x(o,C)?u=o.decoder:u=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p<s.length-1)d in l||(l[d]={}),l=l[d];else{let f=e[c],v=l[d]=f===null?null:u.mapFromDriverValue(f);if(n&&x(o,G)&&s.length===2){let y=s[0];y in r?typeof r[y]=="string"&&r[y]!==Xe(o.table)&&(r[y]=!1):r[y]=v===null?Xe(o.table):!1}}return a},{});if(n&&Object.keys(r).length>0)for(let[a,s]of Object.entries(r))typeof s=="string"&&!n[s]&&(i[a]=null);return i}function dt(t,e){return Object.entries(t).reduce((n,[r,i])=>{if(typeof r!="string")return n;let a=e?[...e,r]:[r];return x(i,G)||x(i,C)||x(i,C.Aliased)?n.push({path:a,field:i}):x(i,T)?n.push(...dt(i[T.Symbol.Columns],a)):n.push(...dt(i,a)),n},[])}function na(t,e){let n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let[i,a]of n.entries())if(a!==r[i])return!1;return!0}function no(t,e){let n=Object.entries(e).filter(([,r])=>r!==void 0).map(([r,i])=>x(i,C)||x(i,G)?[r,i]:[r,new Ye(i,t[T.Symbol.Columns][r])]);if(n.length===0)throw new Error("No values to set");return Object.fromEntries(n)}function s0(t,e){for(let n of e)for(let r of Object.getOwnPropertyNames(n.prototype))r!=="constructor"&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(n.prototype,r)||Object.create(null))}function ro(t){return t[T.Symbol.Columns]}function o0(t){return t[ae].selectedFields}function Lt(t){return x(t,Se)?t._.alias:x(t,Qe)?t[ae].name:x(t,C)?void 0:t[T.Symbol.IsAlias]?t[T.Symbol.Name]:t[T.Symbol.BaseName]}function U(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function c0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var zt=class extends P{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var wl=class extends zt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new Sl(e,this.config)}},Sl=class extends S{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},_l=class extends zt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new El(e,this.config)}},El=class extends S{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function u0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new wl(n):new _l(n)}var kl=class extends P{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Tl(e,this.config)}},Tl=class extends S{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},Cl=class extends P{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new Al(e,this.config)}},Al=class extends S{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function l0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new kl(n):new Cl(n)}var Pl=class extends P{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ql(e,this.config)}},ql=class extends S{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Nr(t){return new Pl(t??"")}var Il=class extends P{static[m]="PgCharBuilder";constructor(e,n){super(e,"string","PgChar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new jl(e,this.config)}},jl=class extends S{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function p0(t,e={}){let{name:n,config:r}=U(t,e);return new Il(n,r)}var Nl=class extends P{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new Ol(e,this.config)}},Ol=class extends S{static[m]="PgCidr";getSQLType(){return"cidr"}};function d0(t){return new Nl(t??"")}var Rl=class extends P{static[m]="PgCustomColumnBuilder";constructor(e,n,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=n,this.config.customTypeParams=r}build(e){return new Dl(e,this.config)}},Dl=class extends S{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,n){super(e,n),this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function f0(t){return(e,n)=>{let{name:r,config:i}=U(e,n);return new Rl(r,i,t)}}var Nt=class extends P{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(h`now()`)}};var Ml=class extends Nt{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new ra(e,this.config)}},ra=class extends S{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Bl=class extends Nt{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ia(e,this.config)}},ia=class extends S{static[m]="PgDateString";getSQLType(){return"date"}};function m0(t,e){let{name:n,config:r}=U(t,e);return r?.mode==="date"?new Ml(n):new Bl(n)}var Fl=class extends P{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Ll(e,this.config)}},Ll=class extends S{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function h0(t){return new Fl(t??"")}var zl=class extends P{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new $l(e,this.config)}},$l=class extends S{static[m]="PgInet";getSQLType(){return"inet"}};function v0(t){return new zl(t??"")}var Ul=class extends zt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Ql(e,this.config)}},Ql=class extends S{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Or(t){return new Ul(t??"")}var Vl=class extends P{static[m]="PgIntervalBuilder";constructor(e,n){super(e,"string","PgInterval"),this.config.intervalConfig=n}build(e){return new Hl(e,this.config)}},Hl=class extends S{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${e}${n}`}};function g0(t,e={}){let{name:n,config:r}=U(t,e);return new Vl(n,r)}var Gl=class extends P{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new aa(e,this.config)}},aa=class extends S{static[m]="PgJson";constructor(e,n){super(e,n)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function y0(t){return new Gl(t??"")}var Kl=class extends P{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new sa(e,this.config)}},sa=class extends S{static[m]="PgJsonb";constructor(e,n){super(e,n)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function oa(t){return new Kl(t??"")}var Wl=class extends P{static[m]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Zl(e,this.config)}},Zl=class extends S{static[m]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Jl=class extends P{static[m]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Xl(e,this.config)}},Xl=class extends S{static[m]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(n),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function x0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new Wl(n):new Jl(n)}var Yl=class extends P{static[m]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new ep(e,this.config)}},ep=class extends S{static[m]="PgMacaddr";getSQLType(){return"macaddr"}};function b0(t){return new Yl(t??"")}var tp=class extends P{static[m]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new np(e,this.config)}},np=class extends S{static[m]="PgMacaddr8";getSQLType(){return"macaddr8"}};function w0(t){return new tp(t??"")}var rp=class extends P{static[m]="PgNumericBuilder";constructor(e,n,r){super(e,"string","PgNumeric"),this.config.precision=n,this.config.scale=r}build(e){return new ca(e,this.config)}},ca=class extends S{static[m]="PgNumeric";precision;scale;constructor(e,n){super(e,n),this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function S0(t,e){let{name:n,config:r}=U(t,e);return new rp(n,r?.precision,r?.scale)}var ip=class extends P{static[m]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new ap(e,this.config)}},ap=class extends S{static[m]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},sp=class extends P{static[m]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new op(e,this.config)}},op=class extends S{static[m]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(n),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function _0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new ip(n):new sp(n)}function z5(t){let e=[];for(let n=0;n<t.length;n+=2)e.push(Number.parseInt(t.slice(n,n+2),16));return new Uint8Array(e)}function E0(t,e){let n=new ArrayBuffer(8),r=new DataView(n);for(let i=0;i<8;i++)r.setUint8(i,t[e+i]);return r.getFloat64(0,!0)}function cp(t){let e=z5(t),n=0,r=e[n];n+=1;let i=new DataView(e.buffer),a=i.getUint32(n,r===1);n+=4;let s;if(a&536870912&&(s=i.getUint32(n,r===1),n+=4),(a&65535)===1){let o=E0(e,n);n+=8;let c=E0(e,n);return n+=8,[o,c]}throw new Error("Unsupported geometry type")}var up=class extends P{static[m]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new lp(e,this.config)}},lp=class extends S{static[m]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return cp(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},pp=class extends P{static[m]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new dp(e,this.config)}},dp=class extends S{static[m]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let n=cp(e);return{x:n[0],y:n[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function k0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new up(n):new pp(n)}var fp=class extends P{static[m]="PgRealBuilder";constructor(e,n){super(e,"number","PgReal"),this.config.length=n}build(e){return new mp(e,this.config)}},mp=class extends S{static[m]="PgReal";constructor(e,n){super(e,n)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function T0(t){return new fp(t??"")}var hp=class extends P{static[m]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new vp(e,this.config)}},vp=class extends S{static[m]="PgSerial";getSQLType(){return"serial"}};function C0(t){return new hp(t??"")}var gp=class extends zt{static[m]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new yp(e,this.config)}},yp=class extends S{static[m]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function A0(t){return new gp(t??"")}var xp=class extends P{static[m]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new bp(e,this.config)}},bp=class extends S{static[m]="PgSmallSerial";getSQLType(){return"smallserial"}};function P0(t){return new xp(t??"")}var wp=class extends P{static[m]="PgTextBuilder";constructor(e,n){super(e,"string","PgText"),this.config.enumValues=n.enum}build(e){return new Sp(e,this.config)}},Sp=class extends S{static[m]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function _t(t,e={}){let{name:n,config:r}=U(t,e);return new wp(n,r)}var _p=class extends Nt{constructor(e,n,r){super(e,"string","PgTime"),this.withTimezone=n,this.precision=r,this.config.withTimezone=n,this.config.precision=r}static[m]="PgTimeBuilder";build(e){return new ua(e,this.config)}},ua=class extends S{static[m]="PgTime";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function q0(t,e={}){let{name:n,config:r}=U(t,e);return new _p(n,r.withTimezone??!1,r.precision)}var Ep=class extends Nt{static[m]="PgTimestampBuilder";constructor(e,n,r){super(e,"date","PgTimestamp"),this.config.withTimezone=n,this.config.precision=r}build(e){return new la(e,this.config)}},la=class extends S{static[m]="PgTimestamp";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},kp=class extends Nt{static[m]="PgTimestampStringBuilder";constructor(e,n,r){super(e,"string","PgTimestampString"),this.config.withTimezone=n,this.config.precision=r}build(e){return new pa(e,this.config)}},pa=class extends S{static[m]="PgTimestampString";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function In(t,e={}){let{name:n,config:r}=U(t,e);return r?.mode==="string"?new kp(n,r.withTimezone??!1,r.precision):new Ep(n,r?.withTimezone??!1,r?.precision)}var Tp=class extends P{static[m]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(h`gen_random_uuid()`)}build(e){return new da(e,this.config)}},da=class extends S{static[m]="PgUUID";getSQLType(){return"uuid"}};function I0(t){return new Tp(t??"")}var Cp=class extends P{static[m]="PgVarcharBuilder";constructor(e,n){super(e,"string","PgVarchar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new Ap(e,this.config)}},Ap=class extends S{static[m]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function ft(t,e={}){let{name:n,config:r}=U(t,e);return new Cp(n,r)}var Pp=class extends P{static[m]="PgBinaryVectorBuilder";constructor(e,n){super(e,"string","PgBinaryVector"),this.config.dimensions=n.dimensions}build(e){return new qp(e,this.config)}},qp=class extends S{static[m]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function j0(t,e){let{name:n,config:r}=U(t,e);return new Pp(n,r)}var Ip=class extends P{static[m]="PgHalfVectorBuilder";constructor(e,n){super(e,"array","PgHalfVector"),this.config.dimensions=n.dimensions}build(e){return new jp(e,this.config)}},jp=class extends S{static[m]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function N0(t,e){let{name:n,config:r}=U(t,e);return new Ip(n,r)}var Np=class extends P{static[m]="PgSparseVectorBuilder";constructor(e,n){super(e,"string","PgSparseVector"),this.config.dimensions=n.dimensions}build(e){return new Op(e,this.config)}},Op=class extends S{static[m]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function O0(t,e){let{name:n,config:r}=U(t,e);return new Np(n,r)}var Rp=class extends P{static[m]="PgVectorBuilder";constructor(e,n){super(e,"array","PgVector"),this.config.dimensions=n.dimensions}build(e){return new Dp(e,this.config)}},Dp=class extends S{static[m]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function R0(t,e){let{name:n,config:r}=U(t,e);return new Rp(n,r)}function D0(){return{bigint:u0,bigserial:l0,boolean:Nr,char:p0,cidr:d0,customType:f0,date:m0,doublePrecision:h0,inet:v0,integer:Or,interval:g0,json:y0,jsonb:oa,line:x0,macaddr:b0,macaddr8:w0,numeric:S0,point:_0,geometry:k0,real:T0,serial:C0,smallint:A0,smallserial:P0,text:_t,time:q0,timestamp:In,uuid:I0,varchar:ft,bit:j0,halfvec:N0,sparsevec:O0,vector:R0}}var Mp=Symbol.for("drizzle:PgInlineForeignKeys"),M0=Symbol.for("drizzle:EnableRLS"),je=class extends T{static[m]="PgTable";static Symbol=Object.assign({},T.Symbol,{InlineForeignKeys:Mp,EnableRLS:M0});[Mp]=[];[M0]=!1;[T.Symbol.ExtraConfigBuilder]=void 0};function $5(t,e,n,r,i=t){let a=new je(t,r,i),s=typeof e=="function"?e(D0()):e,o=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.build(a);return a[Mp].push(...d.buildForeignKeys(f,a)),[l,f]})),c=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.buildExtraConfigColumn(a);return[l,f]})),u=Object.assign(a,o);return u[T.Symbol.Columns]=o,u[T.Symbol.ExtraConfigColumns]=c,n&&(u[je.Symbol.ExtraConfigBuilder]=n),Object.assign(u,{enableRLS:()=>(u[je.Symbol.EnableRLS]=!0,u)})}var fa=(t,e,n)=>$5(t,e,n,void 0);var io=class{static[m]="PgPrimaryKeyBuilder";columns;name;constructor(e,n){this.columns=e,this.name=n}build(e){return new Bp(e,this.columns,this.name)}},Bp=class{constructor(e,n,r){this.table=e,this.columns=n,this.name=r}static[m]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[je.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};var ao=class{constructor(e,n,r){this.sourceTable=e,this.referencedTable=n,this.relationName=r,this.referencedTableName=n[T.Symbol.Name]}static[m]="Relation";referencedTableName;fieldName},so=class{constructor(e,n){this.table=e,this.config=n}static[m]="Relations"},rn=class t extends ao{constructor(e,n,r,i){super(e,n,r?.relationName),this.config=r,this.isNullable=i}static[m]="One";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return n.fieldName=e,n}},ma=class t extends ao{constructor(e,n,r){super(e,n,r?.relationName),this.config=r}static[m]="Many";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,th/app/dist/index.cjs:64
pollmetry-app  | `);Ra.write(kw.format.apply(kw,e))}}Object.defineProperty(Ht.exports,"isWin",{get:function(){return Bo},set:function(t){Bo=t}});Ht.exports.warnTo=function(t){var e=Ra;return Ra=t,e};Ht.exports.getFileName=function(t){var e=t||process.env,n=e.PGPASSFILE||(Bo?Ew.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ew.join(e.HOME||"./",".pgpass"));return n};Ht.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Bo?!0:(e=e||"<unkn>",a9(t.mode)?t.mode&(t9|n9)?(Hd('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hd('WARNING: password file "%s" is not a plain file',e),!1))};var o9=Ht.exports.match=function(t,e){return ei.slice(0,-1).reduce(function(n,r,i){return i==1&&Number(t[r]||e9)===Number(e[r])?n&&!0:n&&(e[r]==="*"||e[r]===t[r])},!0)};Ht.exports.getPassword=function(t,e,n){var r,i=e.pipe(Yq());function a(c){var u=c9(c);u&&u9(u)&&o9(t,u)&&(r=u[s9],i.end())}var s=function(){e.destroy(),n(r)},o=function(c){e.destroy(),Hd("WARNING: error on reading file: %s",c),n(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var c9=Ht.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",n="",r=0,i=0,a=0,s={},o=!1,c=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[ei[l]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),n=t.charAt(u),o=r==Vd-1,o){c(r,i);break}u>=0&&e==":"&&n!=="\\"&&(c(r,i,u+1),i=u+2,r+=1)}return s=Object.keys(s).length===Vd?s:null,s},u9=Ht.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},n=0;n<ei.length;n+=1){var r=e[n],i=t[ei[n]]||"",a=r(i);if(!a)return!1}return!0}});var Aw=g((CF,Gd)=>{"use strict";var TF=require("path"),Cw=require("fs"),Fo=Tw();Gd.exports=function(t,e){var n=Fo.getFileName();Cw.stat(n,function(r,i){if(r||!Fo.usePgPass(i,n))return e(void 0);var a=Cw.createReadStream(n);Fo.getPassword(t,a,e)})};Gd.exports.warnTo=Fo.warnTo});var jw=g((AF,Iw)=>{"use strict";var l9=require("events").EventEmitter,Pw=Wr(),Kd=W1(),p9=Io(),d9=vd(),qw=cw(),f9=Na(),m9=Qd(),h9=fd(),Lo=class extends l9{constructor(e){super(),this.connectionParameters=new d9(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let n=e||{};this._Promise=n.Promise||global.Promise,this._types=new p9(n.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!n.enableChannelBinding,this.connection=n.connection||new m9({stream:n.stream,ssl:this.connectionParameters.ssl,keepAlive:n.keepAlive||!1,keepAliveInitialDelayMillis:n.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=n.binary||f9.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=n.connectionTimeoutMillis||0}_errorAllQueries(e){let n=r=>{process.nextTick(()=>{r.handleError(e,this.connection)})};this.activeQuery&&(n(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(n),this.queryQueue.length=0}_connect(e){let n=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{r._ending=!0,r.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){n.ssl?r.requestSsl():r.startup(n.getStartupConf())}),r.on("sslconnect",function(){r.startup(n.getStartupConf())}),this._attachListeners(r),r.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((n,r)=>{this._connect(i=>{i?r(i):n()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let n=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(r=>{if(r!==void 0){if(typeof r!="string"){n.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()}).catch(r=>{n.emit("error",r)});else if(this.password!==null)e();else try{Aw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(r){this.emit("error",r)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let n=await h9.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(n)}catch(n){this.emit("error",n)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Kd.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(n){this.connection.emit("error",n)}})}async _handleAuthSASLContinue(e){try{await Kd.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(n){this.connection.emit("error",n)}}_handleAuthSASLFinal(e){try{Kd.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(n){this.connection.emit("error",n)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:n}=this;this.activeQuery=null,this.readyForQuery=!0,n&&n.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let n=this.activeQuery;if(!n){this._handleErrorEvent(e);return}this.activeQuery=null,n.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let n=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(n);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,n={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(n.application_name=r),e.replication&&(n.replication=""+e.replication),e.statement_timeout&&(n.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(n.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(n.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(n.options=e.options),n}cancel(e,n){if(e.activeQuery===n){let r=this.connection;this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){r.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(n)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(n),1)}setTypeParser(e,n,r){return this._types.setTypeParser(e,n,r)}getTypeParser(e,n){return this._types.getTypeParser(e,n)}escapeIdentifier(e){return Pw.escapeIdentifier(e)}escapeLiteral(e){return Pw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,n,r){let i,a,s,o,c;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof n=="function"&&(i.callback=i.callback||n)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new qw(e,n,r),i.callback||(a=new this._Promise((u,l)=>{i.callback=(p,d)=>p?l(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),s&&(c=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),c(u),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(n=>{this.connection.once("end",n)})}};Lo.Query=qw;Iw.exports=Lo});var Dw=g((PF,Rw)=>{"use strict";var v9=require("events").EventEmitter,Nw=function(){},Ow=(t,e)=>{let n=t.findIndex(e);return n===-1?void 0:t.splice(n,1)[0]},Wd=class{constructor(e,n,r){this.client=e,this.idleListener=n,this.timeoutId=r}},ti=class{constructor(e){this.callback=e}};function g9(){throw new Error("Release called on client which has already been released to the pool.")}function zo(t,e){if(e)return{callback:e,result:void 0};let n,r,i=function(s,o){s?n(s):r(o)},a=new t(function(s,o){r=s,n=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function y9(t,e){return function n(r){r.client=e,e.removeListener("error",n),e.on("error",()=>{t.log("additional client error after disconnection due to error",r)}),t._remove(e),t.emit("error",r,e)}}var Zd=class extends v9{constructor(e,n){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||n||Jd().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(n=>{this._remove(n.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let n=this._idle.pop();clearTimeout(n.timeoutId);let r=n.client;r.ref&&r.ref();let i=n.idleListener;return this._acquireClient(r,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,n){let r=Ow(this._idle,a=>a.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof n=="function"&&n()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let n=zo(this.Promise,e),r=n.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ti(n.callback)),r;let i=(o,c,u)=>{clearTimeout(s),n.callback(o,c,u)},a=new ti(i),s=setTimeout(()=>{Ow(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,n.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),r}return this.newClient(new ti(n.callback)),r}newClient(e){let n=new this.Client(this.options);this._clients.push(n);let r=y9(this,n);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,n.connection?n.connection.stream.destroy():n.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),n.connect(s=>{if(i&&clearTimeout(i),n.on("error",r),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==n),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,Nw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(n),this._idle.findIndex(u=>u.client===n)!==-1&&this._acquireClient(n,new ti((u,l,p)=>p()),r,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),n.once("end",()=>clearTimeout(o))}return this._acquireClient(n,e,r,!0)}})}_acquireClient(e,n,r,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,r),e.removeListener("error",r),n.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),n.callback(a,void 0,Nw);n.callback(void 0,e,e.release)}):n.callback(void 0,e,e.release)}_releaseOnce(e,n){let r=!1;return i=>{r&&g9(),r=!0,this._release(e,n,i)}}_release(e,n,r){if(e.on("error",n),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",r,e),r||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Wd(e,n,a)),this._pulseQueue()}query(e,n,r){if(typeof e=="function"){let a=zo(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof n=="function"&&(r=n,n=void 0);let i=zo(this.Promise,r);return r=i.callback,this.connect((a,s)=>{if(a)return r(a);let o=!1,c=u=>{o||(o=!0,s.release(u),r(u))};s.once("error",c),this.log("dispatching query");try{s.query(e,n,(u,l)=>{if(this.log("query dispatched"),s.removeListener("error",c),!o)return o=!0,s.release(u),u?r(u):r(void 0,l)})}catch(u){return s.release(u),r(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let r=new Error("Called end on pool more than once");return e?e(r):this.Promise.reject(r)}this.ending=!0;let n=zo(this.Promise,e);return this._endCallback=n.callback,this._pulseQueue(),n.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,n)=>e+(this._expired.has(n)?1:0),0)}get totalCount(){return this._clients.length}};Rw.exports=Zd});var Fw=g((qF,Bw)=>{"use strict";var Mw=require("events").EventEmitter,x9=require("util"),Xd=Wr(),ni=Bw.exports=function(t,e,n){Mw.call(this),t=Xd.normalizeQueryConfig(t,e,n),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(r){r==="row"&&(this._emitRowEvents=!0)}.bind(this))};x9.inherits(ni,Mw);var b9={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};ni.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let n in e){let r=b9[n]||n;t[r]=e[n]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};ni.prototype.then=function(t,e){return this._getPromise().then(t,e)};ni.prototype.catch=function(t){return this._getPromise().catch(t)};ni.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};ni.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let n=function(r,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),r)return e.handleError(r);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(c=>{e.emit("row",c,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(n=process.domain.bind(n)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let r=(this.values||[]).map(Xd.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return n(i)}return t.native.execute(this.name,r,n)}return t.native.prepare(this.name,this.text,r.length,function(i){return i?n(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,r,n))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return n(i)}let r=this.values.map(Xd.prepareValue);t.native.query(this.text,r,n)}else this.queryMode==="extended"?t.native.query(this.text,[],n):t.native.query(this.text,n)}});var Qw=g((IF,Uw)=>{"use strict";var Lw;try{Lw=require("pg-native")}catch(t){throw t}var w9=Io(),zw=require("events").EventEmitter,S9=require("util"),_9=vd(),$w=Fw(),rt=Uw.exports=function(t){zw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new w9(t.types),this.native=new Lw({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new _9(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};rt.Query=$w;S9.inherits(rt,zw);rt.prototype._errorAllQueries=function(t){let e=n=>{process.nextTick(()=>{n.native=this.native,n.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};rt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(n,r){if(e.connectionParameters.nativeConnectionString&&(r=e.connectionParameters.nativeConnectionString),n)return t(n);e.native.connect(r,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};rt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,n)=>{this._connect(r=>{r?n(r):e()})})};rt.prototype.query=function(t,e,n){let r,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=r=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,r=new $w(t,e,n),!r.callback){let c,u;i=new this._Promise((l,p)=>{c=l,u=p}).catch(l=>{throw Error.captureStackTrace(l),l}),r.callback=(l,p)=>l?u(l):c(p)}return a&&(o=r.callback,s=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{r.handleError(c,this.connection)}),o(c),r.callback=()=>{};let u=this._queryQueue.indexOf(r);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),r.callback=(c,u)=>{clearTimeout(s),o(c,u)}),this._queryable?this._ending?(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(r),this._pulseQueryQueue(),i):(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};rt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let n;return t||(n=new this._Promise(function(r,i){t=a=>a?i(a):r()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),n};rt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};rt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let n=this;e.once("_done",function(){n._pulseQueryQueue()})};rt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};rt.prototype.ref=function(){};rt.prototype.unref=function(){};rt.prototype.setTypeParser=function(t,e,n){return this._types.setTypeParser(t,e,n)};rt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Yd=g((jF,Vw)=>{"use strict";Vw.exports=Qw()});var Jd=g((OF,Da)=>{"use strict";var E9=jw(),k9=Na(),T9=Qd(),C9=yd(),A9=Wr(),P9=Dw(),q9=Io(),{DatabaseError:I9}=zd(),{escapeIdentifier:j9,escapeLiteral:N9}=Wr(),O9=t=>class extends P9{constructor(n){super(n,t)}},ef=function(t){this.defaults=k9,this.Client=t,this.Query=this.Client.Query,this.Pool=O9(this.Client),this._pools=[],this.Connection=T9,this.types=ja(),this.DatabaseError=I9,this.TypeOverrides=q9,this.escapeIdentifier=j9,this.escapeLiteral=N9,this.Result=C9,this.utils=A9};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Da.exports=new ef(Yd()):(Da.exports=new ef(E9),Object.defineProperty(Da.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new ef(Yd())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Da.exports,"native",{value:t}),t}}))});var B9={};df(B9,{log:()=>lf});module.exports=oS(B9);var Vo=ai(nl(),1);var Ww=require("socket.io");var Jp={};df(Jp,{EMOJIS:()=>T3,insertQuestionSchema:()=>E3,insertSessionSchema:()=>Zp,insertUserSchema:()=>Wp,insertVoteEventSchema:()=>k3,questionStateEnum:()=>x3,questionTypeEnum:()=>b3,questions:()=>te,questionsRelations:()=>w3,segmentEnum:()=>S3,sessions:()=>oe,sessionsRelations:()=>y3,users:()=>He,usersRelations:()=>g3,voteEvents:()=>de,voteEventsRelations:()=>_3});var m=Symbol.for("drizzle:entityKind"),tN=Symbol.for("drizzle:hasOwnEntityKind");function x(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=Object.getPrototypeOf(t).constructor;if(n)for(;n;){if(m in n&&n[m]===e[m])return!0;n=Object.getPrototypeOf(n)}return!1}var G=class{constructor(e,n){this.table=e,this.config=n,this.name=n.name,this.keyAsName=n.keyAsName,this.notNull=n.notNull,this.default=n.default,this.defaultFn=n.defaultFn,this.onUpdateFn=n.onUpdateFn,this.hasDefault=n.hasDefault,this.primary=n.primaryKey,this.isUnique=n.isUnique,this.uniqueName=n.uniqueName,this.uniqueType=n.uniqueType,this.dataType=n.dataType,this.columnType=n.columnType,this.generated=n.generated,this.generatedIdentity=n.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Ks=class{static[m]="ColumnBuilder";config;constructor(e,n,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:n,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var St=Symbol.for("drizzle:Name");var Ws=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,n){this.reference=()=>{let{name:r,columns:i,foreignColumns:a}=e();return{name:r,columns:i,foreignTable:a[0].table,foreignColumns:a}},n&&(this._onUpdate=n.onUpdate,this._onDelete=n.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new rl(e,this)}},rl=class{constructor(e,n){this.table=e,this.reference=n.reference,this.onUpdate=n._onUpdate,this.onDelete=n._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:n,foreignColumns:r}=this.reference(),i=n.map(o=>o.name),a=r.map(o=>o.name),s=[this.table[St],...i,r[0].table[St],...a];return e??`${s.join("_")}_fk`}};function Zs(t,...e){return t(...e)}function sl(t,e){return`${t[St]}_${e.join("_")}_unique`}var il=class{constructor(e,n){this.name=n,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new al(e,this.columns,this.nullsNotDistinctConfig,this.name)}},wb=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new il(e,this.name)}},al=class{constructor(e,n,r,i){this.table=e,this.columns=n,this.name=i??sl(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=r}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Sb(t,e,n){for(let r=e;r<t.length;r++){let i=t[r];if(i==="\\"){r++;continue}if(i==='"')return[t.slice(e,r).replace(/\\/g,""),r+1];if(!n&&(i===","||i==="}"))return[t.slice(e,r).replace(/\\/g,""),r]}return[t.slice(e).replace(/\\/g,""),t.length]}function _b(t,e=0){let n=[],r=e,i=!1;for(;r<t.length;){let a=t[r];if(a===","){(i||r===e)&&n.push(""),i=!0,r++;continue}if(i=!1,a==="\\"){r+=2;continue}if(a==='"'){let[c,u]=Sb(t,r+1,!0);n.push(c),r=u;continue}if(a==="}")return[n,r+1];if(a==="{"){let[c,u]=_b(t,r+1);n.push(c),r=u;continue}let[s,o]=Sb(t,r,!1);n.push(s),r=o}return[n,r]}function Eb(t){let[e]=_b(t,1);return e}function ol(t){return`{${t.map(e=>Array.isArray(e)?ol(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var P=class extends Ks{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new ul(this.config.name,this,e)}references(e,n={}){return this.foreignKeyConfigs.push({ref:e,actions:n}),this}unique(e,n){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,n){return this.foreignKeyConfigs.map(({ref:r,actions:i})=>Zs((a,s)=>{let o=new Ws(()=>{let c=a();return{columns:[e],foreignColumns:[c]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(n)},r,i))}buildExtraConfigColumn(e){return new cl(e,this.config)}},S=class extends G{constructor(e,n){n.uniqueName||(n.uniqueName=sl(e,[n.name])),super(e,n),this.table=e}static[m]="PgColumn"},cl=class extends S{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},qr=class{static[m]="IndexedColumn";constructor(e,n,r,i){this.name=e,this.keyAsName=n,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},ul=class extends P{static[m]="PgArrayBuilder";constructor(e,n,r){super(e,"array","PgArray"),this.config.baseBuilder=n,this.config.size=r}build(e){let n=this.config.baseBuilder.build(e);return new ll(e,this.config,n)}},ll=class t extends S{constructor(e,n,r,i){super(e,n),this.baseColumn=r,this.range=i,this.size=n.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Eb(e)),e.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(e,n=!1){let r=e.map(i=>i===null?null:x(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return n?r:ol(r)}};var kb=Symbol.for("drizzle:isPgEnum");function Cb(t){return!!t&&typeof t=="function"&&kb in t&&t[kb]===!0}var Tb=class extends P{static[m]="PgEnumColumnBuilder";constructor(e,n){super(e,"string","PgEnumColumn"),this.config.enum=n}build(e){return new pl(e,this.config)}},pl=class extends S{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,n){super(e,n),this.enum=n.enum}getSQLType(){return this.enum.enumName}};var Se=class{static[m]="Subquery";constructor(e,n,r,i=!1){this._={brand:"Subquery",sql:e,selectedFields:n,alias:r,isWith:i}}},Ir=class extends Se{static[m]="WithSubquery"};var Ab="0.39.3";var dl,fl,ie={startActiveSpan(t,e){return dl?(fl||(fl=dl.trace.getTracer("drizzle-orm",Ab)),Zs((n,r)=>r.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:n.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),dl,fl)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Js=Symbol.for("drizzle:Schema"),Xs=Symbol.for("drizzle:Columns"),Pb=Symbol.for("drizzle:ExtraConfigColumns"),ml=Symbol.for("drizzle:OriginalName"),hl=Symbol.for("drizzle:BaseName"),Zi=Symbol.for("drizzle:IsAlias"),qb=Symbol.for("drizzle:ExtraConfigBuilder"),Ib=Symbol.for("drizzle:IsDrizzleTable"),T=class{static[m]="Table";static Symbol={Name:St,Schema:Js,OriginalName:ml,Columns:Xs,ExtraConfigColumns:Pb,BaseName:hl,IsAlias:Zi,ExtraConfigBuilder:qb};[St];[ml];[Js];[Xs];[Pb];[hl];[Zi]=!1;[Ib]=!0;[qb]=void 0;constructor(e,n,r){this[St]=this[ml]=e,this[Js]=n,this[hl]=r}};function vl(t){return typeof t=="object"&&t!==null&&Ib in t}function Xe(t){return t[St]}function Pn(t){return`${t[Js]??"public"}.${t[St]}`}var jb=class{static[m]="FakePrimitiveParam"};function gl(t){return t!=null&&typeof t.getSQL=="function"}function L5(t){let e={sql:"",params:[]};for(let n of t)e.sql+=n.sql,e.params.push(...n.params),n.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...n.typings));return e}var _e=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new C([this])}},C=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=Ob;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ie.startActiveSpan("drizzle.buildSQL",n=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return n?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,n){let r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:c,paramStartIndex:u}=r;return L5(e.map(l=>{if(x(l,_e))return{sql:l.value.join(""),params:[]};if(x(l,Ji))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new _e("(")];for(let[d,f]of l.entries())p.push(f),d<l.length-1&&p.push(new _e(", "));return p.push(new _e(")")),this.buildQueryFromSourceParams(p,r)}if(x(l,t))return this.buildQueryFromSourceParams(l.queryChunks,{...r,inlineParams:c||l.shouldInlineParams});if(x(l,T)){let p=l[T.Symbol.Schema],d=l[T.Symbol.Name];return{sql:p===void 0||l[Zi]?a(d):a(p)+"."+a(d),params:[]}}if(x(l,G)){let p=i.getColumnCasing(l);if(n.invokeSource==="indexes")return{sql:a(p),params:[]};let d=l.table[T.Symbol.Schema];return{sql:l.table[Zi]||d===void 0?a(l.table[T.Symbol.Name])+"."+a(p):a(d)+"."+a(l.table[T.Symbol.Name])+"."+a(p),params:[]}}if(x(l,Qe)){let p=l[ae].schema,d=l[ae].name;return{sql:p===void 0||l[ae].isAlias?a(d):a(p)+"."+a(d),params:[]}}if(x(l,Ye)){if(x(l.value,Ft))return{sql:s(u.value++,l),params:[l],typings:["none"]};let p=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(x(p,t))return this.buildQueryFromSourceParams([p],r);if(c)return{sql:this.mapInlineParam(p,r),params:[]};let d=["none"];return o&&(d=[o(l.encoder)]),{sql:s(u.value++,p),params:[p],typings:d}}return x(l,Ft)?{sql:s(u.value++,l),params:[l],typings:["none"]}:x(l,t.Aliased)&&l.fieldAlias!==void 0?{sql:a(l.fieldAlias),params:[]}:x(l,Se)?l._.isWith?{sql:a(l._.alias),params:[]}:this.buildQueryFromSourceParams([new _e("("),l._.sql,new _e(") "),new Ji(l._.alias)],r):Cb(l)?l.schema?{sql:a(l.schema)+"."+a(l.enumName),params:[]}:{sql:a(l.enumName),params:[]}:gl(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],r):this.buildQueryFromSourceParams([new _e("("),l.getSQL(),new _e(")")],r):c?{sql:this.mapInlineParam(l,r),params:[]}:{sql:s(u.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:n}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return n(e);if(typeof e=="object"){let r=e.toString();return n(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},Ji=class{constructor(e){this.value=e}static[m]="Name";brand;getSQL(){return new C([this])}};function Nb(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Ob={mapFromDriverValue:t=>t},Rb={mapToDriverValue:t=>t},QN={...Ob,...Rb},Ye=class{constructor(e,n=Rb){this.value=e,this.encoder=n}static[m]="Param";brand;getSQL(){return new C([this])}};function h(t,...e){let n=[];(e.length>0||t.length>0&&t[0]!=="")&&n.push(new _e(t[0]));for(let[r,i]of e.entries())n.push(i,new _e(t[r+1]));return new C(n)}(t=>{function e(){return new C([])}t.empty=e;function n(c){return new C(c)}t.fromList=n;function r(c){return new C([new _e(c)])}t.raw=r;function i(c,u){let l=[];for(let[p,d]of c.entries())p>0&&u!==void 0&&l.push(u),l.push(d);return new C(l)}t.join=i;function a(c){return new Ji(c)}t.identifier=a;function s(c){return new Ft(c)}t.placeholder=s;function o(c,u){return new Ye(c,u)}t.param=o})(h||(h={}));(t=>{class e{constructor(r,i){this.sql=r,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(C||(C={}));var Ft=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new C([this])}};function yl(t,e){return t.map(n=>{if(x(n,Ft)){if(!(n.name in e))throw new Error(`No value for placeholder "${n.name}" was provided`);return e[n.name]}if(x(n,Ye)&&x(n.value,Ft)){if(!(n.value.name in e))throw new Error(`No value for placeholder "${n.value.name}" was provided`);return n.encoder.mapToDriverValue(e[n.value.name])}return n})}var Db=Symbol.for("drizzle:IsDrizzleView"),Qe=class{static[m]="View";[ae];[Db]=!0;constructor({name:e,schema:n,selectedFields:r,query:i}){this[ae]={name:e,originalName:e,schema:n,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new C([this])}};function Mb(t){return typeof t=="object"&&t!==null&&Db in t}G.prototype.getSQL=function(){return new C([this])};T.prototype.getSQL=function(){return new C([this])};Se.prototype.getSQL=function(){return new C([this])};var qn=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,n){return n==="table"?this.table:e[n]}},jr=class{constructor(e,n){this.alias=e,this.replaceOriginalName=n}static[m]="TableAliasProxyHandler";get(e,n){if(n===T.Symbol.IsAlias)return!0;if(n===T.Symbol.Name)return this.alias;if(this.replaceOriginalName&&n===T.Symbol.OriginalName)return this.alias;if(n===ae)return{...e[ae],name:this.alias,isAlias:!0};if(n===T.Symbol.Columns){let i=e[T.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new qn(new Proxy(e,this)))}),a}let r=e[n];return x(r,G)?new Proxy(r,new qn(new Proxy(e,this))):r}},Bb=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,n){return n==="sourceTable"?Xi(e.sourceTable,this.alias):e[n]}};function Xi(t,e){return new Proxy(t,new jr(e,!1))}function jt(t,e){return new Proxy(t,new qn(new Proxy(t.table,new jr(e,!1))))}function xl(t,e){return new C.Aliased(Yi(t.sql,e),t.fieldAlias)}function Yi(t,e){return h.join(t.queryChunks.map(n=>x(n,G)?jt(n,e):x(n,C)?Yi(n,e):x(n,C.Aliased)?xl(n,e):n))}var ea=class extends Error{static[m]="DrizzleError";constructor({message:e,cause:n}){super(e),this.name="DrizzleError",this.cause=n}},Ys=class extends ea{static[m]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function et(t,e){return Nb(e)&&!gl(t)&&!x(t,Ye)&&!x(t,Ft)&&!x(t,G)&&!x(t,T)&&!x(t,Qe)?new Ye(t,e):t}var ee=(t,e)=>h`${t} = ${et(e,t)}`,Fb=(t,e)=>h`${t} <> ${et(e,t)}`;function nn(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" and ")),new _e(")")])}function Lb(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" or ")),new _e(")")])}function zb(t){return h`not ${t}`}var $b=(t,e)=>h`${t} > ${et(e,t)}`,Ub=(t,e)=>h`${t} >= ${et(e,t)}`,Qb=(t,e)=>h`${t} < ${et(e,t)}`,Vb=(t,e)=>h`${t} <= ${et(e,t)}`;function Hb(t,e){return Array.isArray(e)?e.length===0?h`false`:h`${t} in ${e.map(n=>et(n,t))}`:h`${t} in ${et(e,t)}`}function Gb(t,e){return Array.isArray(e)?e.length===0?h`true`:h`${t} not in ${e.map(n=>et(n,t))}`:h`${t} not in ${et(e,t)}`}function Kb(t){return h`${t} is null`}function Wb(t){return h`${t} is not null`}function Zb(t){return h`exists ${t}`}function Jb(t){return h`not exists ${t}`}function Xb(t,e,n){return h`${t} between ${et(e,t)} and ${et(n,t)}`}function Yb(t,e,n){return h`${t} not between ${et(e,t)} and ${et(n,t)}`}function e0(t,e){return h`${t} like ${e}`}function t0(t,e){return h`${t} not like ${e}`}function n0(t,e){return h`${t} ilike ${e}`}function r0(t,e){return h`${t} not ilike ${e}`}function i0(t){return h`${t} asc`}function ta(t){return h`${t} desc`}var bl=class{static[m]="ConsoleLogWriter";write(e){console.log(e)}},eo=class{static[m]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new bl}logQuery(e,n){let r=n.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},to=class{static[m]="NoopLogger";logQuery(){}};var Re=class{static[m]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(n=>(e?.(),n),n=>{throw e?.(),n})}then(e,n){return this.execute().then(e,n)}};function a0(t,e,n){let r={},i=t.reduce((a,{path:s,field:o},c)=>{let u;x(o,G)?u=o:x(o,C)?u=o.decoder:u=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p<s.length-1)d in l||(l[d]={}),l=l[d];else{let f=e[c],v=l[d]=f===null?null:u.mapFromDriverValue(f);if(n&&x(o,G)&&s.length===2){let y=s[0];y in r?typeof r[y]=="string"&&r[y]!==Xe(o.table)&&(r[y]=!1):r[y]=v===null?Xe(o.table):!1}}return a},{});if(n&&Object.keys(r).length>0)for(let[a,s]of Object.entries(r))typeof s=="string"&&!n[s]&&(i[a]=null);return i}function dt(t,e){return Object.entries(t).reduce((n,[r,i])=>{if(typeof r!="string")return n;let a=e?[...e,r]:[r];return x(i,G)||x(i,C)||x(i,C.Aliased)?n.push({path:a,field:i}):x(i,T)?n.push(...dt(i[T.Symbol.Columns],a)):n.push(...dt(i,a)),n},[])}function na(t,e){let n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let[i,a]of n.entries())if(a!==r[i])return!1;return!0}function no(t,e){let n=Object.entries(e).filter(([,r])=>r!==void 0).map(([r,i])=>x(i,C)||x(i,G)?[r,i]:[r,new Ye(i,t[T.Symbol.Columns][r])]);if(n.length===0)throw new Error("No values to set");return Object.fromEntries(n)}function s0(t,e){for(let n of e)for(let r of Object.getOwnPropertyNames(n.prototype))r!=="constructor"&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(n.prototype,r)||Object.create(null))}function ro(t){return t[T.Symbol.Columns]}function o0(t){return t[ae].selectedFields}function Lt(t){return x(t,Se)?t._.alias:x(t,Qe)?t[ae].name:x(t,C)?void 0:t[T.Symbol.IsAlias]?t[T.Symbol.Name]:t[T.Symbol.BaseName]}function U(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function c0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var zt=class extends P{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var wl=class extends zt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new Sl(e,this.config)}},Sl=class extends S{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},_l=class extends zt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new El(e,this.config)}},El=class extends S{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function u0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new wl(n):new _l(n)}var kl=class extends P{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Tl(e,this.config)}},Tl=class extends S{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},Cl=class extends P{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new Al(e,this.config)}},Al=class extends S{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function l0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new kl(n):new Cl(n)}var Pl=class extends P{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ql(e,this.config)}},ql=class extends S{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Nr(t){return new Pl(t??"")}var Il=class extends P{static[m]="PgCharBuilder";constructor(e,n){super(e,"string","PgChar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new jl(e,this.config)}},jl=class extends S{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function p0(t,e={}){let{name:n,config:r}=U(t,e);return new Il(n,r)}var Nl=class extends P{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new Ol(e,this.config)}},Ol=class extends S{static[m]="PgCidr";getSQLType(){return"cidr"}};function d0(t){return new Nl(t??"")}var Rl=class extends P{static[m]="PgCustomColumnBuilder";constructor(e,n,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=n,this.config.customTypeParams=r}build(e){return new Dl(e,this.config)}},Dl=class extends S{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,n){super(e,n),this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function f0(t){return(e,n)=>{let{name:r,config:i}=U(e,n);return new Rl(r,i,t)}}var Nt=class extends P{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(h`now()`)}};var Ml=class extends Nt{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new ra(e,this.config)}},ra=class extends S{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Bl=class extends Nt{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ia(e,this.config)}},ia=class extends S{static[m]="PgDateString";getSQLType(){return"date"}};function m0(t,e){let{name:n,config:r}=U(t,e);return r?.mode==="date"?new Ml(n):new Bl(n)}var Fl=class extends P{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Ll(e,this.config)}},Ll=class extends S{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function h0(t){return new Fl(t??"")}var zl=class extends P{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new $l(e,this.config)}},$l=class extends S{static[m]="PgInet";getSQLType(){return"inet"}};function v0(t){return new zl(t??"")}var Ul=class extends zt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Ql(e,this.config)}},Ql=class extends S{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Or(t){return new Ul(t??"")}var Vl=class extends P{static[m]="PgIntervalBuilder";constructor(e,n){super(e,"string","PgInterval"),this.config.intervalConfig=n}build(e){return new Hl(e,this.config)}},Hl=class extends S{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${e}${n}`}};function g0(t,e={}){let{name:n,config:r}=U(t,e);return new Vl(n,r)}var Gl=class extends P{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new aa(e,this.config)}},aa=class extends S{static[m]="PgJson";constructor(e,n){super(e,n)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function y0(t){return new Gl(t??"")}var Kl=class extends P{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new sa(e,this.config)}},sa=class extends S{static[m]="PgJsonb";constructor(e,n){super(e,n)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function oa(t){return new Kl(t??"")}var Wl=class extends P{static[m]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Zl(e,this.config)}},Zl=class extends S{static[m]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Jl=class extends P{static[m]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Xl(e,this.config)}},Xl=class extends S{static[m]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(n),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function x0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new Wl(n):new Jl(n)}var Yl=class extends P{static[m]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new ep(e,this.config)}},ep=class extends S{static[m]="PgMacaddr";getSQLType(){return"macaddr"}};function b0(t){return new Yl(t??"")}var tp=class extends P{static[m]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new np(e,this.config)}},np=class extends S{static[m]="PgMacaddr8";getSQLType(){return"macaddr8"}};function w0(t){return new tp(t??"")}var rp=class extends P{static[m]="PgNumericBuilder";constructor(e,n,r){super(e,"string","PgNumeric"),this.config.precision=n,this.config.scale=r}build(e){return new ca(e,this.config)}},ca=class extends S{static[m]="PgNumeric";precision;scale;constructor(e,n){super(e,n),this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function S0(t,e){let{name:n,config:r}=U(t,e);return new rp(n,r?.precision,r?.scale)}var ip=class extends P{static[m]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new ap(e,this.config)}},ap=class extends S{static[m]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},sp=class extends P{static[m]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new op(e,this.config)}},op=class extends S{static[m]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(n),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function _0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new ip(n):new sp(n)}function z5(t){let e=[];for(let n=0;n<t.length;n+=2)e.push(Number.parseInt(t.slice(n,n+2),16));return new Uint8Array(e)}function E0(t,e){let n=new ArrayBuffer(8),r=new DataView(n);for(let i=0;i<8;i++)r.setUint8(i,t[e+i]);return r.getFloat64(0,!0)}function cp(t){let e=z5(t),n=0,r=e[n];n+=1;let i=new DataView(e.buffer),a=i.getUint32(n,r===1);n+=4;let s;if(a&536870912&&(s=i.getUint32(n,r===1),n+=4),(a&65535)===1){let o=E0(e,n);n+=8;let c=E0(e,n);return n+=8,[o,c]}throw new Error("Unsupported geometry type")}var up=class extends P{static[m]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new lp(e,this.config)}},lp=class extends S{static[m]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return cp(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},pp=class extends P{static[m]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new dp(e,this.config)}},dp=class extends S{static[m]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let n=cp(e);return{x:n[0],y:n[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function k0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new up(n):new pp(n)}var fp=class extends P{static[m]="PgRealBuilder";constructor(e,n){super(e,"number","PgReal"),this.config.length=n}build(e){return new mp(e,this.config)}},mp=class extends S{static[m]="PgReal";constructor(e,n){super(e,n)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function T0(t){return new fp(t??"")}var hp=class extends P{static[m]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new vp(e,this.config)}},vp=class extends S{static[m]="PgSerial";getSQLType(){return"serial"}};function C0(t){return new hp(t??"")}var gp=class extends zt{static[m]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new yp(e,this.config)}},yp=class extends S{static[m]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function A0(t){return new gp(t??"")}var xp=class extends P{static[m]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new bp(e,this.config)}},bp=class extends S{static[m]="PgSmallSerial";getSQLType(){return"smallserial"}};function P0(t){return new xp(t??"")}var wp=class extends P{static[m]="PgTextBuilder";constructor(e,n){super(e,"string","PgText"),this.config.enumValues=n.enum}build(e){return new Sp(e,this.config)}},Sp=class extends S{static[m]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function _t(t,e={}){let{name:n,config:r}=U(t,e);return new wp(n,r)}var _p=class extends Nt{constructor(e,n,r){super(e,"string","PgTime"),this.withTimezone=n,this.precision=r,this.config.withTimezone=n,this.config.precision=r}static[m]="PgTimeBuilder";build(e){return new ua(e,this.config)}},ua=class extends S{static[m]="PgTime";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function q0(t,e={}){let{name:n,config:r}=U(t,e);return new _p(n,r.withTimezone??!1,r.precision)}var Ep=class extends Nt{static[m]="PgTimestampBuilder";constructor(e,n,r){super(e,"date","PgTimestamp"),this.config.withTimezone=n,this.config.precision=r}build(e){return new la(e,this.config)}},la=class extends S{static[m]="PgTimestamp";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},kp=class extends Nt{static[m]="PgTimestampStringBuilder";constructor(e,n,r){super(e,"string","PgTimestampString"),this.config.withTimezone=n,this.config.precision=r}build(e){return new pa(e,this.config)}},pa=class extends S{static[m]="PgTimestampString";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function In(t,e={}){let{name:n,config:r}=U(t,e);return r?.mode==="string"?new kp(n,r.withTimezone??!1,r.precision):new Ep(n,r?.withTimezone??!1,r?.precision)}var Tp=class extends P{static[m]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(h`gen_random_uuid()`)}build(e){return new da(e,this.config)}},da=class extends S{static[m]="PgUUID";getSQLType(){return"uuid"}};function I0(t){return new Tp(t??"")}var Cp=class extends P{static[m]="PgVarcharBuilder";constructor(e,n){super(e,"string","PgVarchar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new Ap(e,this.config)}},Ap=class extends S{static[m]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function ft(t,e={}){let{name:n,config:r}=U(t,e);return new Cp(n,r)}var Pp=class extends P{static[m]="PgBinaryVectorBuilder";constructor(e,n){super(e,"string","PgBinaryVector"),this.config.dimensions=n.dimensions}build(e){return new qp(e,this.config)}},qp=class extends S{static[m]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function j0(t,e){let{name:n,config:r}=U(t,e);return new Pp(n,r)}var Ip=class extends P{static[m]="PgHalfVectorBuilder";constructor(e,n){super(e,"array","PgHalfVector"),this.config.dimensions=n.dimensions}build(e){return new jp(e,this.config)}},jp=class extends S{static[m]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function N0(t,e){let{name:n,config:r}=U(t,e);return new Ip(n,r)}var Np=class extends P{static[m]="PgSparseVectorBuilder";constructor(e,n){super(e,"string","PgSparseVector"),this.config.dimensions=n.dimensions}build(e){return new Op(e,this.config)}},Op=class extends S{static[m]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function O0(t,e){let{name:n,config:r}=U(t,e);return new Np(n,r)}var Rp=class extends P{static[m]="PgVectorBuilder";constructor(e,n){super(e,"array","PgVector"),this.config.dimensions=n.dimensions}build(e){return new Dp(e,this.config)}},Dp=class extends S{static[m]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function R0(t,e){let{name:n,config:r}=U(t,e);return new Rp(n,r)}function D0(){return{bigint:u0,bigserial:l0,boolean:Nr,char:p0,cidr:d0,customType:f0,date:m0,doublePrecision:h0,inet:v0,integer:Or,interval:g0,json:y0,jsonb:oa,line:x0,macaddr:b0,macaddr8:w0,numeric:S0,point:_0,geometry:k0,real:T0,serial:C0,smallint:A0,smallserial:P0,text:_t,time:q0,timestamp:In,uuid:I0,varchar:ft,bit:j0,halfvec:N0,sparsevec:O0,vector:R0}}var Mp=Symbol.for("drizzle:PgInlineForeignKeys"),M0=Symbol.for("drizzle:EnableRLS"),je=class extends T{static[m]="PgTable";static Symbol=Object.assign({},T.Symbol,{InlineForeignKeys:Mp,EnableRLS:M0});[Mp]=[];[M0]=!1;[T.Symbol.ExtraConfigBuilder]=void 0};function $5(t,e,n,r,i=t){let a=new je(t,r,i),s=typeof e=="function"?e(D0()):e,o=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.build(a);return a[Mp].push(...d.buildForeignKeys(f,a)),[l,f]})),c=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.buildExtraConfigColumn(a);return[l,f]})),u=Object.assign(a,o);return u[T.Symbol.Columns]=o,u[T.Symbol.ExtraConfigColumns]=c,n&&(u[je.Symbol.ExtraConfigBuilder]=n),Object.assign(u,{enableRLS:()=>(u[je.Symbol.EnableRLS]=!0,u)})}var fa=(t,e,n)=>$5(t,e,n,void 0);var io=class{static[m]="PgPrimaryKeyBuilder";columns;name;constructor(e,n){this.columns=e,this.name=n}build(e){return new Bp(e,this.columns,this.name)}},Bp=class{constructor(e,n,r){this.table=e,this.columns=n,this.name=r}static[m]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[je.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};var ao=class{constructor(e,n,r){this.sourceTable=e,this.referencedTable=n,this.relationName=r,this.referencedTableName=n[T.Symbol.Name]}static[m]="Relation";referencedTableName;fieldName},so=class{constructor(e,n){this.table=e,this.config=n}static[m]="Relations"},rn=class t extends ao{constructor(e,n,r,i){super(e,n,r?.relationName),this.config=r,this.isNullable=i}static[m]="One";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return n.fieldName=e,n}},ma=class t extends ao{constructor(e,n,r){super(e,n,r?.relationName),this.config=r}static[m]="Many";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,th/app/dist/index.cjs:64
pollmetry-app  | `);Ra.write(kw.format.apply(kw,e))}}Object.defineProperty(Ht.exports,"isWin",{get:function(){return Bo},set:function(t){Bo=t}});Ht.exports.warnTo=function(t){var e=Ra;return Ra=t,e};Ht.exports.getFileName=function(t){var e=t||process.env,n=e.PGPASSFILE||(Bo?Ew.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ew.join(e.HOME||"./",".pgpass"));return n};Ht.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Bo?!0:(e=e||"<unkn>",a9(t.mode)?t.mode&(t9|n9)?(Hd('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Hd('WARNING: password file "%s" is not a plain file',e),!1))};var o9=Ht.exports.match=function(t,e){return ei.slice(0,-1).reduce(function(n,r,i){return i==1&&Number(t[r]||e9)===Number(e[r])?n&&!0:n&&(e[r]==="*"||e[r]===t[r])},!0)};Ht.exports.getPassword=function(t,e,n){var r,i=e.pipe(Yq());function a(c){var u=c9(c);u&&u9(u)&&o9(t,u)&&(r=u[s9],i.end())}var s=function(){e.destroy(),n(r)},o=function(c){e.destroy(),Hd("WARNING: error on reading file: %s",c),n(void 0)};e.on("error",o),i.on("data",a).on("end",s).on("error",o)};var c9=Ht.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",n="",r=0,i=0,a=0,s={},o=!1,c=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),s[ei[l]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),n=t.charAt(u),o=r==Vd-1,o){c(r,i);break}u>=0&&e==":"&&n!=="\\"&&(c(r,i,u+1),i=u+2,r+=1)}return s=Object.keys(s).length===Vd?s:null,s},u9=Ht.exports.isValidEntry=function(t){for(var e={0:function(s){return s.length>0},1:function(s){return s==="*"?!0:(s=Number(s),isFinite(s)&&s>0&&s<9007199254740992&&Math.floor(s)===s)},2:function(s){return s.length>0},3:function(s){return s.length>0},4:function(s){return s.length>0}},n=0;n<ei.length;n+=1){var r=e[n],i=t[ei[n]]||"",a=r(i);if(!a)return!1}return!0}});var Aw=g((CF,Gd)=>{"use strict";var TF=require("path"),Cw=require("fs"),Fo=Tw();Gd.exports=function(t,e){var n=Fo.getFileName();Cw.stat(n,function(r,i){if(r||!Fo.usePgPass(i,n))return e(void 0);var a=Cw.createReadStream(n);Fo.getPassword(t,a,e)})};Gd.exports.warnTo=Fo.warnTo});var jw=g((AF,Iw)=>{"use strict";var l9=require("events").EventEmitter,Pw=Wr(),Kd=W1(),p9=Io(),d9=vd(),qw=cw(),f9=Na(),m9=Qd(),h9=fd(),Lo=class extends l9{constructor(e){super(),this.connectionParameters=new d9(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let n=e||{};this._Promise=n.Promise||global.Promise,this._types=new p9(n.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!n.enableChannelBinding,this.connection=n.connection||new m9({stream:n.stream,ssl:this.connectionParameters.ssl,keepAlive:n.keepAlive||!1,keepAliveInitialDelayMillis:n.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=n.binary||f9.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=n.connectionTimeoutMillis||0}_errorAllQueries(e){let n=r=>{process.nextTick(()=>{r.handleError(e,this.connection)})};this.activeQuery&&(n(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(n),this.queryQueue.length=0}_connect(e){let n=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{r._ending=!0,r.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){n.ssl?r.requestSsl():r.startup(n.getStartupConf())}),r.on("sslconnect",function(){r.startup(n.getStartupConf())}),this._attachListeners(r),r.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((n,r)=>{this._connect(i=>{i?r(i):n()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let n=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(r=>{if(r!==void 0){if(typeof r!="string"){n.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()}).catch(r=>{n.emit("error",r)});else if(this.password!==null)e();else try{Aw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(r){this.emit("error",r)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let n=await h9.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(n)}catch(n){this.emit("error",n)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Kd.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(n){this.connection.emit("error",n)}})}async _handleAuthSASLContinue(e){try{await Kd.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(n){this.connection.emit("error",n)}}_handleAuthSASLFinal(e){try{Kd.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(n){this.connection.emit("error",n)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:n}=this;this.activeQuery=null,this.readyForQuery=!0,n&&n.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let n=this.activeQuery;if(!n){this._handleErrorEvent(e);return}this.activeQuery=null,n.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let n=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(n);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,n={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(n.application_name=r),e.replication&&(n.replication=""+e.replication),e.statement_timeout&&(n.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(n.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(n.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(n.options=e.options),n}cancel(e,n){if(e.activeQuery===n){let r=this.connection;this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){r.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(n)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(n),1)}setTypeParser(e,n,r){return this._types.setTypeParser(e,n,r)}getTypeParser(e,n){return this._types.getTypeParser(e,n)}escapeIdentifier(e){return Pw.escapeIdentifier(e)}escapeLiteral(e){return Pw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,n,r){let i,a,s,o,c;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(s=e.query_timeout||this.connectionParameters.query_timeout,a=i=e,typeof n=="function"&&(i.callback=i.callback||n)):(s=e.query_timeout||this.connectionParameters.query_timeout,i=new qw(e,n,r),i.callback||(a=new this._Promise((u,l)=>{i.callback=(p,d)=>p?l(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),s&&(c=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),c(u),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},s),i.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(i),this._pulseQueryQueue(),a):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(n=>{this.connection.once("end",n)})}};Lo.Query=qw;Iw.exports=Lo});var Dw=g((PF,Rw)=>{"use strict";var v9=require("events").EventEmitter,Nw=function(){},Ow=(t,e)=>{let n=t.findIndex(e);return n===-1?void 0:t.splice(n,1)[0]},Wd=class{constructor(e,n,r){this.client=e,this.idleListener=n,this.timeoutId=r}},ti=class{constructor(e){this.callback=e}};function g9(){throw new Error("Release called on client which has already been released to the pool.")}function zo(t,e){if(e)return{callback:e,result:void 0};let n,r,i=function(s,o){s?n(s):r(o)},a=new t(function(s,o){r=s,n=o}).catch(s=>{throw Error.captureStackTrace(s),s});return{callback:i,result:a}}function y9(t,e){return function n(r){r.client=e,e.removeListener("error",n),e.on("error",()=>{t.log("additional client error after disconnection due to error",r)}),t._remove(e),t.emit("error",r,e)}}var Zd=class extends v9{constructor(e,n){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||n||Jd().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(n=>{this._remove(n.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let n=this._idle.pop();clearTimeout(n.timeoutId);let r=n.client;r.ref&&r.ref();let i=n.idleListener;return this._acquireClient(r,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,n){let r=Ow(this._idle,a=>a.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(a=>a!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof n=="function"&&n()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let n=zo(this.Promise,e),r=n.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ti(n.callback)),r;let i=(o,c,u)=>{clearTimeout(s),n.callback(o,c,u)},a=new ti(i),s=setTimeout(()=>{Ow(this._pendingQueue,o=>o.callback===i),a.timedOut=!0,n.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return s.unref&&s.unref(),this._pendingQueue.push(a),r}return this.newClient(new ti(n.callback)),r}newClient(e){let n=new this.Client(this.options);this._clients.push(n);let r=y9(this,n);this.log("checking client timeout");let i,a=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,n.connection?n.connection.stream.destroy():n.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),n.connect(s=>{if(i&&clearTimeout(i),n.on("error",r),s)this.log("client failed to connect",s),this._clients=this._clients.filter(o=>o!==n),a&&(s=new Error("Connection terminated due to connection timeout",{cause:s})),this._pulseQueue(),e.timedOut||e.callback(s,void 0,Nw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(n),this._idle.findIndex(u=>u.client===n)!==-1&&this._acquireClient(n,new ti((u,l,p)=>p()),r,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),n.once("end",()=>clearTimeout(o))}return this._acquireClient(n,e,r,!0)}})}_acquireClient(e,n,r,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,r),e.removeListener("error",r),n.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),n.callback(a,void 0,Nw);n.callback(void 0,e,e.release)}):n.callback(void 0,e,e.release)}_releaseOnce(e,n){let r=!1;return i=>{r&&g9(),r=!0,this._release(e,n,i)}}_release(e,n,r){if(e.on("error",n),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",r,e),r||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let a;this.options.idleTimeoutMillis&&this._isAboveMin()&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Wd(e,n,a)),this._pulseQueue()}query(e,n,r){if(typeof e=="function"){let a=zo(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof n=="function"&&(r=n,n=void 0);let i=zo(this.Promise,r);return r=i.callback,this.connect((a,s)=>{if(a)return r(a);let o=!1,c=u=>{o||(o=!0,s.release(u),r(u))};s.once("error",c),this.log("dispatching query");try{s.query(e,n,(u,l)=>{if(this.log("query dispatched"),s.removeListener("error",c),!o)return o=!0,s.release(u),u?r(u):r(void 0,l)})}catch(u){return s.release(u),r(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let r=new Error("Called end on pool more than once");return e?e(r):this.Promise.reject(r)}this.ending=!0;let n=zo(this.Promise,e);return this._endCallback=n.callback,this._pulseQueue(),n.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,n)=>e+(this._expired.has(n)?1:0),0)}get totalCount(){return this._clients.length}};Rw.exports=Zd});var Fw=g((qF,Bw)=>{"use strict";var Mw=require("events").EventEmitter,x9=require("util"),Xd=Wr(),ni=Bw.exports=function(t,e,n){Mw.call(this),t=Xd.normalizeQueryConfig(t,e,n),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(r){r==="row"&&(this._emitRowEvents=!0)}.bind(this))};x9.inherits(ni,Mw);var b9={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};ni.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let n in e){let r=b9[n]||n;t[r]=e[n]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};ni.prototype.then=function(t,e){return this._getPromise().then(t,e)};ni.prototype.catch=function(t){return this._getPromise().catch(t)};ni.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};ni.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let n=function(r,i,a){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),r)return e.handleError(r);e._emitRowEvents&&(a.length>1?i.forEach((s,o)=>{s.forEach(c=>{e.emit("row",c,a[o])})}):i.forEach(function(s){e.emit("row",s,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(n=process.domain.bind(n)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let r=(this.values||[]).map(Xd.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return n(i)}return t.native.execute(this.name,r,n)}return t.native.prepare(this.name,this.text,r.length,function(i){return i?n(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,r,n))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return n(i)}let r=this.values.map(Xd.prepareValue);t.native.query(this.text,r,n)}else this.queryMode==="extended"?t.native.query(this.text,[],n):t.native.query(this.text,n)}});var Qw=g((IF,Uw)=>{"use strict";var Lw;try{Lw=require("pg-native")}catch(t){throw t}var w9=Io(),zw=require("events").EventEmitter,S9=require("util"),_9=vd(),$w=Fw(),rt=Uw.exports=function(t){zw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new w9(t.types),this.native=new Lw({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new _9(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};rt.Query=$w;S9.inherits(rt,zw);rt.prototype._errorAllQueries=function(t){let e=n=>{process.nextTick(()=>{n.native=this.native,n.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};rt.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(n,r){if(e.connectionParameters.nativeConnectionString&&(r=e.connectionParameters.nativeConnectionString),n)return t(n);e.native.connect(r,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};rt.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,n)=>{this._connect(r=>{r?n(r):e()})})};rt.prototype.query=function(t,e,n){let r,i,a,s,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,i=r=t,typeof e=="function"&&(t.callback=e);else if(a=t.query_timeout||this.connectionParameters.query_timeout,r=new $w(t,e,n),!r.callback){let c,u;i=new this._Promise((l,p)=>{c=l,u=p}).catch(l=>{throw Error.captureStackTrace(l),l}),r.callback=(l,p)=>l?u(l):c(p)}return a&&(o=r.callback,s=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{r.handleError(c,this.connection)}),o(c),r.callback=()=>{};let u=this._queryQueue.indexOf(r);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),r.callback=(c,u)=>{clearTimeout(s),o(c,u)}),this._queryable?this._ending?(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(r),this._pulseQueryQueue(),i):(r.native=this.native,process.nextTick(()=>{r.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};rt.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let n;return t||(n=new this._Promise(function(r,i){t=a=>a?i(a):r()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),n};rt.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};rt.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let n=this;e.once("_done",function(){n._pulseQueryQueue()})};rt.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};rt.prototype.ref=function(){};rt.prototype.unref=function(){};rt.prototype.setTypeParser=function(t,e,n){return this._types.setTypeParser(t,e,n)};rt.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Yd=g((jF,Vw)=>{"use strict";Vw.exports=Qw()});var Jd=g((OF,Da)=>{"use strict";var E9=jw(),k9=Na(),T9=Qd(),C9=yd(),A9=Wr(),P9=Dw(),q9=Io(),{DatabaseError:I9}=zd(),{escapeIdentifier:j9,escapeLiteral:N9}=Wr(),O9=t=>class extends P9{constructor(n){super(n,t)}},ef=function(t){this.defaults=k9,this.Client=t,this.Query=this.Client.Query,this.Pool=O9(this.Client),this._pools=[],this.Connection=T9,this.types=ja(),this.DatabaseError=I9,this.TypeOverrides=q9,this.escapeIdentifier=j9,this.escapeLiteral=N9,this.Result=C9,this.utils=A9};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Da.exports=new ef(Yd()):(Da.exports=new ef(E9),Object.defineProperty(Da.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new ef(Yd())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Da.exports,"native",{value:t}),t}}))});var B9={};df(B9,{log:()=>lf});module.exports=oS(B9);var Vo=ai(nl(),1);var Ww=require("socket.io");var Jp={};df(Jp,{EMOJIS:()=>T3,insertQuestionSchema:()=>E3,insertSessionSchema:()=>Zp,insertUserSchema:()=>Wp,insertVoteEventSchema:()=>k3,questionStateEnum:()=>x3,questionTypeEnum:()=>b3,questions:()=>te,questionsRelations:()=>w3,segmentEnum:()=>S3,sessions:()=>oe,sessionsRelations:()=>y3,users:()=>He,usersRelations:()=>g3,voteEvents:()=>de,voteEventsRelations:()=>_3});var m=Symbol.for("drizzle:entityKind"),tN=Symbol.for("drizzle:hasOwnEntityKind");function x(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=Object.getPrototypeOf(t).constructor;if(n)for(;n;){if(m in n&&n[m]===e[m])return!0;n=Object.getPrototypeOf(n)}return!1}var G=class{constructor(e,n){this.table=e,this.config=n,this.name=n.name,this.keyAsName=n.keyAsName,this.notNull=n.notNull,this.default=n.default,this.defaultFn=n.defaultFn,this.onUpdateFn=n.onUpdateFn,this.hasDefault=n.hasDefault,this.primary=n.primaryKey,this.isUnique=n.isUnique,this.uniqueName=n.uniqueName,this.uniqueType=n.uniqueType,this.dataType=n.dataType,this.columnType=n.columnType,this.generated=n.generated,this.generatedIdentity=n.generatedIdentity}static[m]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Ks=class{static[m]="ColumnBuilder";config;constructor(e,n,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:n,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var St=Symbol.for("drizzle:Name");var Ws=class{static[m]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,n){this.reference=()=>{let{name:r,columns:i,foreignColumns:a}=e();return{name:r,columns:i,foreignTable:a[0].table,foreignColumns:a}},n&&(this._onUpdate=n.onUpdate,this._onDelete=n.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new rl(e,this)}},rl=class{constructor(e,n){this.table=e,this.reference=n.reference,this.onUpdate=n._onUpdate,this.onDelete=n._onDelete}static[m]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:n,foreignColumns:r}=this.reference(),i=n.map(o=>o.name),a=r.map(o=>o.name),s=[this.table[St],...i,r[0].table[St],...a];return e??`${s.join("_")}_fk`}};function Zs(t,...e){return t(...e)}function sl(t,e){return`${t[St]}_${e.join("_")}_unique`}var il=class{constructor(e,n){this.name=n,this.columns=e}static[m]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new al(e,this.columns,this.nullsNotDistinctConfig,this.name)}},wb=class{static[m]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new il(e,this.name)}},al=class{constructor(e,n,r,i){this.table=e,this.columns=n,this.name=i??sl(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=r}static[m]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Sb(t,e,n){for(let r=e;r<t.length;r++){let i=t[r];if(i==="\\"){r++;continue}if(i==='"')return[t.slice(e,r).replace(/\\/g,""),r+1];if(!n&&(i===","||i==="}"))return[t.slice(e,r).replace(/\\/g,""),r]}return[t.slice(e).replace(/\\/g,""),t.length]}function _b(t,e=0){let n=[],r=e,i=!1;for(;r<t.length;){let a=t[r];if(a===","){(i||r===e)&&n.push(""),i=!0,r++;continue}if(i=!1,a==="\\"){r+=2;continue}if(a==='"'){let[c,u]=Sb(t,r+1,!0);n.push(c),r=u;continue}if(a==="}")return[n,r+1];if(a==="{"){let[c,u]=_b(t,r+1);n.push(c),r=u;continue}let[s,o]=Sb(t,r,!1);n.push(s),r=o}return[n,r]}function Eb(t){let[e]=_b(t,1);return e}function ol(t){return`{${t.map(e=>Array.isArray(e)?ol(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var P=class extends Ks{foreignKeyConfigs=[];static[m]="PgColumnBuilder";array(e){return new ul(this.config.name,this,e)}references(e,n={}){return this.foreignKeyConfigs.push({ref:e,actions:n}),this}unique(e,n){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,n){return this.foreignKeyConfigs.map(({ref:r,actions:i})=>Zs((a,s)=>{let o=new Ws(()=>{let c=a();return{columns:[e],foreignColumns:[c]}});return s.onUpdate&&o.onUpdate(s.onUpdate),s.onDelete&&o.onDelete(s.onDelete),o.build(n)},r,i))}buildExtraConfigColumn(e){return new cl(e,this.config)}},S=class extends G{constructor(e,n){n.uniqueName||(n.uniqueName=sl(e,[n.name])),super(e,n),this.table=e}static[m]="PgColumn"},cl=class extends S{static[m]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},qr=class{static[m]="IndexedColumn";constructor(e,n,r,i){this.name=e,this.keyAsName=n,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},ul=class extends P{static[m]="PgArrayBuilder";constructor(e,n,r){super(e,"array","PgArray"),this.config.baseBuilder=n,this.config.size=r}build(e){let n=this.config.baseBuilder.build(e);return new ll(e,this.config,n)}},ll=class t extends S{constructor(e,n,r,i){super(e,n),this.baseColumn=r,this.range=i,this.size=n.size}size;static[m]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Eb(e)),e.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(e,n=!1){let r=e.map(i=>i===null?null:x(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return n?r:ol(r)}};var kb=Symbol.for("drizzle:isPgEnum");function Cb(t){return!!t&&typeof t=="function"&&kb in t&&t[kb]===!0}var Tb=class extends P{static[m]="PgEnumColumnBuilder";constructor(e,n){super(e,"string","PgEnumColumn"),this.config.enum=n}build(e){return new pl(e,this.config)}},pl=class extends S{static[m]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,n){super(e,n),this.enum=n.enum}getSQLType(){return this.enum.enumName}};var Se=class{static[m]="Subquery";constructor(e,n,r,i=!1){this._={brand:"Subquery",sql:e,selectedFields:n,alias:r,isWith:i}}},Ir=class extends Se{static[m]="WithSubquery"};var Ab="0.39.3";var dl,fl,ie={startActiveSpan(t,e){return dl?(fl||(fl=dl.trace.getTracer("drizzle-orm",Ab)),Zs((n,r)=>r.startActiveSpan(t,i=>{try{return e(i)}catch(a){throw i.setStatus({code:n.SpanStatusCode.ERROR,message:a instanceof Error?a.message:"Unknown error"}),a}finally{i.end()}}),dl,fl)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Js=Symbol.for("drizzle:Schema"),Xs=Symbol.for("drizzle:Columns"),Pb=Symbol.for("drizzle:ExtraConfigColumns"),ml=Symbol.for("drizzle:OriginalName"),hl=Symbol.for("drizzle:BaseName"),Zi=Symbol.for("drizzle:IsAlias"),qb=Symbol.for("drizzle:ExtraConfigBuilder"),Ib=Symbol.for("drizzle:IsDrizzleTable"),T=class{static[m]="Table";static Symbol={Name:St,Schema:Js,OriginalName:ml,Columns:Xs,ExtraConfigColumns:Pb,BaseName:hl,IsAlias:Zi,ExtraConfigBuilder:qb};[St];[ml];[Js];[Xs];[Pb];[hl];[Zi]=!1;[Ib]=!0;[qb]=void 0;constructor(e,n,r){this[St]=this[ml]=e,this[Js]=n,this[hl]=r}};function vl(t){return typeof t=="object"&&t!==null&&Ib in t}function Xe(t){return t[St]}function Pn(t){return`${t[Js]??"public"}.${t[St]}`}var jb=class{static[m]="FakePrimitiveParam"};function gl(t){return t!=null&&typeof t.getSQL=="function"}function L5(t){let e={sql:"",params:[]};for(let n of t)e.sql+=n.sql,e.params.push(...n.params),n.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...n.typings));return e}var _e=class{static[m]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new C([this])}},C=class t{constructor(e){this.queryChunks=e}static[m]="SQL";decoder=Ob;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ie.startActiveSpan("drizzle.buildSQL",n=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return n?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,n){let r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{casing:i,escapeName:a,escapeParam:s,prepareTyping:o,inlineParams:c,paramStartIndex:u}=r;return L5(e.map(l=>{if(x(l,_e))return{sql:l.value.join(""),params:[]};if(x(l,Ji))return{sql:a(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new _e("(")];for(let[d,f]of l.entries())p.push(f),d<l.length-1&&p.push(new _e(", "));return p.push(new _e(")")),this.buildQueryFromSourceParams(p,r)}if(x(l,t))return this.buildQueryFromSourceParams(l.queryChunks,{...r,inlineParams:c||l.shouldInlineParams});if(x(l,T)){let p=l[T.Symbol.Schema],d=l[T.Symbol.Name];return{sql:p===void 0||l[Zi]?a(d):a(p)+"."+a(d),params:[]}}if(x(l,G)){let p=i.getColumnCasing(l);if(n.invokeSource==="indexes")return{sql:a(p),params:[]};let d=l.table[T.Symbol.Schema];return{sql:l.table[Zi]||d===void 0?a(l.table[T.Symbol.Name])+"."+a(p):a(d)+"."+a(l.table[T.Symbol.Name])+"."+a(p),params:[]}}if(x(l,Qe)){let p=l[ae].schema,d=l[ae].name;return{sql:p===void 0||l[ae].isAlias?a(d):a(p)+"."+a(d),params:[]}}if(x(l,Ye)){if(x(l.value,Ft))return{sql:s(u.value++,l),params:[l],typings:["none"]};let p=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(x(p,t))return this.buildQueryFromSourceParams([p],r);if(c)return{sql:this.mapInlineParam(p,r),params:[]};let d=["none"];return o&&(d=[o(l.encoder)]),{sql:s(u.value++,p),params:[p],typings:d}}return x(l,Ft)?{sql:s(u.value++,l),params:[l],typings:["none"]}:x(l,t.Aliased)&&l.fieldAlias!==void 0?{sql:a(l.fieldAlias),params:[]}:x(l,Se)?l._.isWith?{sql:a(l._.alias),params:[]}:this.buildQueryFromSourceParams([new _e("("),l._.sql,new _e(") "),new Ji(l._.alias)],r):Cb(l)?l.schema?{sql:a(l.schema)+"."+a(l.enumName),params:[]}:{sql:a(l.enumName),params:[]}:gl(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],r):this.buildQueryFromSourceParams([new _e("("),l.getSQL(),new _e(")")],r):c?{sql:this.mapInlineParam(l,r),params:[]}:{sql:s(u.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:n}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return n(e);if(typeof e=="object"){let r=e.toString();return n(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},Ji=class{constructor(e){this.value=e}static[m]="Name";brand;getSQL(){return new C([this])}};function Nb(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Ob={mapFromDriverValue:t=>t},Rb={mapToDriverValue:t=>t},QN={...Ob,...Rb},Ye=class{constructor(e,n=Rb){this.value=e,this.encoder=n}static[m]="Param";brand;getSQL(){return new C([this])}};function h(t,...e){let n=[];(e.length>0||t.length>0&&t[0]!=="")&&n.push(new _e(t[0]));for(let[r,i]of e.entries())n.push(i,new _e(t[r+1]));return new C(n)}(t=>{function e(){return new C([])}t.empty=e;function n(c){return new C(c)}t.fromList=n;function r(c){return new C([new _e(c)])}t.raw=r;function i(c,u){let l=[];for(let[p,d]of c.entries())p>0&&u!==void 0&&l.push(u),l.push(d);return new C(l)}t.join=i;function a(c){return new Ji(c)}t.identifier=a;function s(c){return new Ft(c)}t.placeholder=s;function o(c,u){return new Ye(c,u)}t.param=o})(h||(h={}));(t=>{class e{constructor(r,i){this.sql=r,this.fieldAlias=i}static[m]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(C||(C={}));var Ft=class{constructor(e){this.name=e}static[m]="Placeholder";getSQL(){return new C([this])}};function yl(t,e){return t.map(n=>{if(x(n,Ft)){if(!(n.name in e))throw new Error(`No value for placeholder "${n.name}" was provided`);return e[n.name]}if(x(n,Ye)&&x(n.value,Ft)){if(!(n.value.name in e))throw new Error(`No value for placeholder "${n.value.name}" was provided`);return n.encoder.mapToDriverValue(e[n.value.name])}return n})}var Db=Symbol.for("drizzle:IsDrizzleView"),Qe=class{static[m]="View";[ae];[Db]=!0;constructor({name:e,schema:n,selectedFields:r,query:i}){this[ae]={name:e,originalName:e,schema:n,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new C([this])}};function Mb(t){return typeof t=="object"&&t!==null&&Db in t}G.prototype.getSQL=function(){return new C([this])};T.prototype.getSQL=function(){return new C([this])};Se.prototype.getSQL=function(){return new C([this])};var qn=class{constructor(e){this.table=e}static[m]="ColumnAliasProxyHandler";get(e,n){return n==="table"?this.table:e[n]}},jr=class{constructor(e,n){this.alias=e,this.replaceOriginalName=n}static[m]="TableAliasProxyHandler";get(e,n){if(n===T.Symbol.IsAlias)return!0;if(n===T.Symbol.Name)return this.alias;if(this.replaceOriginalName&&n===T.Symbol.OriginalName)return this.alias;if(n===ae)return{...e[ae],name:this.alias,isAlias:!0};if(n===T.Symbol.Columns){let i=e[T.Symbol.Columns];if(!i)return i;let a={};return Object.keys(i).map(s=>{a[s]=new Proxy(i[s],new qn(new Proxy(e,this)))}),a}let r=e[n];return x(r,G)?new Proxy(r,new qn(new Proxy(e,this))):r}},Bb=class{constructor(e){this.alias=e}static[m]="RelationTableAliasProxyHandler";get(e,n){return n==="sourceTable"?Xi(e.sourceTable,this.alias):e[n]}};function Xi(t,e){return new Proxy(t,new jr(e,!1))}function jt(t,e){return new Proxy(t,new qn(new Proxy(t.table,new jr(e,!1))))}function xl(t,e){return new C.Aliased(Yi(t.sql,e),t.fieldAlias)}function Yi(t,e){return h.join(t.queryChunks.map(n=>x(n,G)?jt(n,e):x(n,C)?Yi(n,e):x(n,C.Aliased)?xl(n,e):n))}var ea=class extends Error{static[m]="DrizzleError";constructor({message:e,cause:n}){super(e),this.name="DrizzleError",this.cause=n}},Ys=class extends ea{static[m]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function et(t,e){return Nb(e)&&!gl(t)&&!x(t,Ye)&&!x(t,Ft)&&!x(t,G)&&!x(t,T)&&!x(t,Qe)?new Ye(t,e):t}var ee=(t,e)=>h`${t} = ${et(e,t)}`,Fb=(t,e)=>h`${t} <> ${et(e,t)}`;function nn(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" and ")),new _e(")")])}function Lb(...t){let e=t.filter(n=>n!==void 0);if(e.length!==0)return e.length===1?new C(e):new C([new _e("("),h.join(e,new _e(" or ")),new _e(")")])}function zb(t){return h`not ${t}`}var $b=(t,e)=>h`${t} > ${et(e,t)}`,Ub=(t,e)=>h`${t} >= ${et(e,t)}`,Qb=(t,e)=>h`${t} < ${et(e,t)}`,Vb=(t,e)=>h`${t} <= ${et(e,t)}`;function Hb(t,e){return Array.isArray(e)?e.length===0?h`false`:h`${t} in ${e.map(n=>et(n,t))}`:h`${t} in ${et(e,t)}`}function Gb(t,e){return Array.isArray(e)?e.length===0?h`true`:h`${t} not in ${e.map(n=>et(n,t))}`:h`${t} not in ${et(e,t)}`}function Kb(t){return h`${t} is null`}function Wb(t){return h`${t} is not null`}function Zb(t){return h`exists ${t}`}function Jb(t){return h`not exists ${t}`}function Xb(t,e,n){return h`${t} between ${et(e,t)} and ${et(n,t)}`}function Yb(t,e,n){return h`${t} not between ${et(e,t)} and ${et(n,t)}`}function e0(t,e){return h`${t} like ${e}`}function t0(t,e){return h`${t} not like ${e}`}function n0(t,e){return h`${t} ilike ${e}`}function r0(t,e){return h`${t} not ilike ${e}`}function i0(t){return h`${t} asc`}function ta(t){return h`${t} desc`}var bl=class{static[m]="ConsoleLogWriter";write(e){console.log(e)}},eo=class{static[m]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new bl}logQuery(e,n){let r=n.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},to=class{static[m]="NoopLogger";logQuery(){}};var Re=class{static[m]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(n=>(e?.(),n),n=>{throw e?.(),n})}then(e,n){return this.execute().then(e,n)}};function a0(t,e,n){let r={},i=t.reduce((a,{path:s,field:o},c)=>{let u;x(o,G)?u=o:x(o,C)?u=o.decoder:u=o.sql.decoder;let l=a;for(let[p,d]of s.entries())if(p<s.length-1)d in l||(l[d]={}),l=l[d];else{let f=e[c],v=l[d]=f===null?null:u.mapFromDriverValue(f);if(n&&x(o,G)&&s.length===2){let y=s[0];y in r?typeof r[y]=="string"&&r[y]!==Xe(o.table)&&(r[y]=!1):r[y]=v===null?Xe(o.table):!1}}return a},{});if(n&&Object.keys(r).length>0)for(let[a,s]of Object.entries(r))typeof s=="string"&&!n[s]&&(i[a]=null);return i}function dt(t,e){return Object.entries(t).reduce((n,[r,i])=>{if(typeof r!="string")return n;let a=e?[...e,r]:[r];return x(i,G)||x(i,C)||x(i,C.Aliased)?n.push({path:a,field:i}):x(i,T)?n.push(...dt(i[T.Symbol.Columns],a)):n.push(...dt(i,a)),n},[])}function na(t,e){let n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let[i,a]of n.entries())if(a!==r[i])return!1;return!0}function no(t,e){let n=Object.entries(e).filter(([,r])=>r!==void 0).map(([r,i])=>x(i,C)||x(i,G)?[r,i]:[r,new Ye(i,t[T.Symbol.Columns][r])]);if(n.length===0)throw new Error("No values to set");return Object.fromEntries(n)}function s0(t,e){for(let n of e)for(let r of Object.getOwnPropertyNames(n.prototype))r!=="constructor"&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(n.prototype,r)||Object.create(null))}function ro(t){return t[T.Symbol.Columns]}function o0(t){return t[ae].selectedFields}function Lt(t){return x(t,Se)?t._.alias:x(t,Qe)?t[ae].name:x(t,C)?void 0:t[T.Symbol.IsAlias]?t[T.Symbol.Name]:t[T.Symbol.BaseName]}function U(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function c0(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var zt=class extends P{static[m]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:n,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var wl=class extends zt{static[m]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new Sl(e,this.config)}},Sl=class extends S{static[m]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},_l=class extends zt{static[m]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new El(e,this.config)}},El=class extends S{static[m]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function u0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new wl(n):new _l(n)}var kl=class extends P{static[m]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Tl(e,this.config)}},Tl=class extends S{static[m]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},Cl=class extends P{static[m]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new Al(e,this.config)}},Al=class extends S{static[m]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function l0(t,e){let{name:n,config:r}=U(t,e);return r.mode==="number"?new kl(n):new Cl(n)}var Pl=class extends P{static[m]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ql(e,this.config)}},ql=class extends S{static[m]="PgBoolean";getSQLType(){return"boolean"}};function Nr(t){return new Pl(t??"")}var Il=class extends P{static[m]="PgCharBuilder";constructor(e,n){super(e,"string","PgChar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new jl(e,this.config)}},jl=class extends S{static[m]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function p0(t,e={}){let{name:n,config:r}=U(t,e);return new Il(n,r)}var Nl=class extends P{static[m]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new Ol(e,this.config)}},Ol=class extends S{static[m]="PgCidr";getSQLType(){return"cidr"}};function d0(t){return new Nl(t??"")}var Rl=class extends P{static[m]="PgCustomColumnBuilder";constructor(e,n,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=n,this.config.customTypeParams=r}build(e){return new Dl(e,this.config)}},Dl=class extends S{static[m]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,n){super(e,n),this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function f0(t){return(e,n)=>{let{name:r,config:i}=U(e,n);return new Rl(r,i,t)}}var Nt=class extends P{static[m]="PgDateColumnBaseBuilder";defaultNow(){return this.default(h`now()`)}};var Ml=class extends Nt{static[m]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new ra(e,this.config)}},ra=class extends S{static[m]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Bl=class extends Nt{static[m]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ia(e,this.config)}},ia=class extends S{static[m]="PgDateString";getSQLType(){return"date"}};function m0(t,e){let{name:n,config:r}=U(t,e);return r?.mode==="date"?new Ml(n):new Bl(n)}var Fl=class extends P{static[m]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Ll(e,this.config)}},Ll=class extends S{static[m]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function h0(t){return new Fl(t??"")}var zl=class extends P{static[m]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new $l(e,this.config)}},$l=class extends S{static[m]="PgInet";getSQLType(){return"inet"}};function v0(t){return new zl(t??"")}var Ul=class extends zt{static[m]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Ql(e,this.config)}},Ql=class extends S{static[m]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Or(t){return new Ul(t??"")}var Vl=class extends P{static[m]="PgIntervalBuilder";constructor(e,n){super(e,"string","PgInterval"),this.config.intervalConfig=n}build(e){return new Hl(e,this.config)}},Hl=class extends S{static[m]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${e}${n}`}};function g0(t,e={}){let{name:n,config:r}=U(t,e);return new Vl(n,r)}var Gl=class extends P{static[m]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new aa(e,this.config)}},aa=class extends S{static[m]="PgJson";constructor(e,n){super(e,n)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function y0(t){return new Gl(t??"")}var Kl=class extends P{static[m]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new sa(e,this.config)}},sa=class extends S{static[m]="PgJsonb";constructor(e,n){super(e,n)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function oa(t){return new Kl(t??"")}var Wl=class extends P{static[m]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Zl(e,this.config)}},Zl=class extends S{static[m]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Jl=class extends P{static[m]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Xl(e,this.config)}},Xl=class extends S{static[m]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[n,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(n),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function x0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new Wl(n):new Jl(n)}var Yl=class extends P{static[m]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new ep(e,this.config)}},ep=class extends S{static[m]="PgMacaddr";getSQLType(){return"macaddr"}};function b0(t){return new Yl(t??"")}var tp=class extends P{static[m]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new np(e,this.config)}},np=class extends S{static[m]="PgMacaddr8";getSQLType(){return"macaddr8"}};function w0(t){return new tp(t??"")}var rp=class extends P{static[m]="PgNumericBuilder";constructor(e,n,r){super(e,"string","PgNumeric"),this.config.precision=n,this.config.scale=r}build(e){return new ca(e,this.config)}},ca=class extends S{static[m]="PgNumeric";precision;scale;constructor(e,n){super(e,n),this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function S0(t,e){let{name:n,config:r}=U(t,e);return new rp(n,r?.precision,r?.scale)}var ip=class extends P{static[m]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new ap(e,this.config)}},ap=class extends S{static[m]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},sp=class extends P{static[m]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new op(e,this.config)}},op=class extends S{static[m]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[n,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(n),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function _0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new ip(n):new sp(n)}function z5(t){let e=[];for(let n=0;n<t.length;n+=2)e.push(Number.parseInt(t.slice(n,n+2),16));return new Uint8Array(e)}function E0(t,e){let n=new ArrayBuffer(8),r=new DataView(n);for(let i=0;i<8;i++)r.setUint8(i,t[e+i]);return r.getFloat64(0,!0)}function cp(t){let e=z5(t),n=0,r=e[n];n+=1;let i=new DataView(e.buffer),a=i.getUint32(n,r===1);n+=4;let s;if(a&536870912&&(s=i.getUint32(n,r===1),n+=4),(a&65535)===1){let o=E0(e,n);n+=8;let c=E0(e,n);return n+=8,[o,c]}throw new Error("Unsupported geometry type")}var up=class extends P{static[m]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new lp(e,this.config)}},lp=class extends S{static[m]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return cp(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},pp=class extends P{static[m]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new dp(e,this.config)}},dp=class extends S{static[m]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let n=cp(e);return{x:n[0],y:n[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function k0(t,e){let{name:n,config:r}=U(t,e);return!r?.mode||r.mode==="tuple"?new up(n):new pp(n)}var fp=class extends P{static[m]="PgRealBuilder";constructor(e,n){super(e,"number","PgReal"),this.config.length=n}build(e){return new mp(e,this.config)}},mp=class extends S{static[m]="PgReal";constructor(e,n){super(e,n)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function T0(t){return new fp(t??"")}var hp=class extends P{static[m]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new vp(e,this.config)}},vp=class extends S{static[m]="PgSerial";getSQLType(){return"serial"}};function C0(t){return new hp(t??"")}var gp=class extends zt{static[m]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new yp(e,this.config)}},yp=class extends S{static[m]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function A0(t){return new gp(t??"")}var xp=class extends P{static[m]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new bp(e,this.config)}},bp=class extends S{static[m]="PgSmallSerial";getSQLType(){return"smallserial"}};function P0(t){return new xp(t??"")}var wp=class extends P{static[m]="PgTextBuilder";constructor(e,n){super(e,"string","PgText"),this.config.enumValues=n.enum}build(e){return new Sp(e,this.config)}},Sp=class extends S{static[m]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function _t(t,e={}){let{name:n,config:r}=U(t,e);return new wp(n,r)}var _p=class extends Nt{constructor(e,n,r){super(e,"string","PgTime"),this.withTimezone=n,this.precision=r,this.config.withTimezone=n,this.config.precision=r}static[m]="PgTimeBuilder";build(e){return new ua(e,this.config)}},ua=class extends S{static[m]="PgTime";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function q0(t,e={}){let{name:n,config:r}=U(t,e);return new _p(n,r.withTimezone??!1,r.precision)}var Ep=class extends Nt{static[m]="PgTimestampBuilder";constructor(e,n,r){super(e,"date","PgTimestamp"),this.config.withTimezone=n,this.config.precision=r}build(e){return new la(e,this.config)}},la=class extends S{static[m]="PgTimestamp";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},kp=class extends Nt{static[m]="PgTimestampStringBuilder";constructor(e,n,r){super(e,"string","PgTimestampString"),this.config.withTimezone=n,this.config.precision=r}build(e){return new pa(e,this.config)}},pa=class extends S{static[m]="PgTimestampString";withTimezone;precision;constructor(e,n){super(e,n),this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function In(t,e={}){let{name:n,config:r}=U(t,e);return r?.mode==="string"?new kp(n,r.withTimezone??!1,r.precision):new Ep(n,r?.withTimezone??!1,r?.precision)}var Tp=class extends P{static[m]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(h`gen_random_uuid()`)}build(e){return new da(e,this.config)}},da=class extends S{static[m]="PgUUID";getSQLType(){return"uuid"}};function I0(t){return new Tp(t??"")}var Cp=class extends P{static[m]="PgVarcharBuilder";constructor(e,n){super(e,"string","PgVarchar"),this.config.length=n.length,this.config.enumValues=n.enum}build(e){return new Ap(e,this.config)}},Ap=class extends S{static[m]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function ft(t,e={}){let{name:n,config:r}=U(t,e);return new Cp(n,r)}var Pp=class extends P{static[m]="PgBinaryVectorBuilder";constructor(e,n){super(e,"string","PgBinaryVector"),this.config.dimensions=n.dimensions}build(e){return new qp(e,this.config)}},qp=class extends S{static[m]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function j0(t,e){let{name:n,config:r}=U(t,e);return new Pp(n,r)}var Ip=class extends P{static[m]="PgHalfVectorBuilder";constructor(e,n){super(e,"array","PgHalfVector"),this.config.dimensions=n.dimensions}build(e){return new jp(e,this.config)}},jp=class extends S{static[m]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function N0(t,e){let{name:n,config:r}=U(t,e);return new Ip(n,r)}var Np=class extends P{static[m]="PgSparseVectorBuilder";constructor(e,n){super(e,"string","PgSparseVector"),this.config.dimensions=n.dimensions}build(e){return new Op(e,this.config)}},Op=class extends S{static[m]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function O0(t,e){let{name:n,config:r}=U(t,e);return new Np(n,r)}var Rp=class extends P{static[m]="PgVectorBuilder";constructor(e,n){super(e,"array","PgVector"),this.config.dimensions=n.dimensions}build(e){return new Dp(e,this.config)}},Dp=class extends S{static[m]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};function R0(t,e){let{name:n,config:r}=U(t,e);return new Rp(n,r)}function D0(){return{bigint:u0,bigserial:l0,boolean:Nr,char:p0,cidr:d0,customType:f0,date:m0,doublePrecision:h0,inet:v0,integer:Or,interval:g0,json:y0,jsonb:oa,line:x0,macaddr:b0,macaddr8:w0,numeric:S0,point:_0,geometry:k0,real:T0,serial:C0,smallint:A0,smallserial:P0,text:_t,time:q0,timestamp:In,uuid:I0,varchar:ft,bit:j0,halfvec:N0,sparsevec:O0,vector:R0}}var Mp=Symbol.for("drizzle:PgInlineForeignKeys"),M0=Symbol.for("drizzle:EnableRLS"),je=class extends T{static[m]="PgTable";static Symbol=Object.assign({},T.Symbol,{InlineForeignKeys:Mp,EnableRLS:M0});[Mp]=[];[M0]=!1;[T.Symbol.ExtraConfigBuilder]=void 0};function $5(t,e,n,r,i=t){let a=new je(t,r,i),s=typeof e=="function"?e(D0()):e,o=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.build(a);return a[Mp].push(...d.buildForeignKeys(f,a)),[l,f]})),c=Object.fromEntries(Object.entries(s).map(([l,p])=>{let d=p;d.setName(l);let f=d.buildExtraConfigColumn(a);return[l,f]})),u=Object.assign(a,o);return u[T.Symbol.Columns]=o,u[T.Symbol.ExtraConfigColumns]=c,n&&(u[je.Symbol.ExtraConfigBuilder]=n),Object.assign(u,{enableRLS:()=>(u[je.Symbol.EnableRLS]=!0,u)})}var fa=(t,e,n)=>$5(t,e,n,void 0);var io=class{static[m]="PgPrimaryKeyBuilder";columns;name;constructor(e,n){this.columns=e,this.name=n}build(e){return new Bp(e,this.columns,this.name)}},Bp=class{constructor(e,n,r){this.table=e,this.columns=n,this.name=r}static[m]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[je.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};var ao=class{constructor(e,n,r){this.sourceTable=e,this.referencedTable=n,this.relationName=r,this.referencedTableName=n[T.Symbol.Name]}static[m]="Relation";referencedTableName;fieldName},so=class{constructor(e,n){this.table=e,this.config=n}static[m]="Relations"},rn=class t extends ao{constructor(e,n,r,i){super(e,n,r?.relationName),this.config=r,this.isNullable=i}static[m]="One";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return n.fieldName=e,n}},ma=class t extends ao{constructor(e,n,r){super(e,n,r?.relationName),this.config=r}static[m]="Many";withFieldName(e){let n=new t(this.sourceTable,this.referencedTable,th/app/dist/index.cjs:64
pollmetry-db   | 2026-01-16 19:09:21.208 UTC [75] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:21.208 UTC [75] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-app  | /app/dist/index.cjs:64
pollmetry-app exited with code 1 (restarting)
pollmetry-db   | 2026-01-16 19:09:25.164 UTC [83] ERROR:  relation "users" does not exist at character 54
pollmetry-db   | 2026-01-16 19:09:25.164 UTC [83] STATEMENT:  select "id", "username", "password", "is_admin" from "users" where "users"."username" = $1
pollmetry-app  | /app/dist/index.cjs:64
